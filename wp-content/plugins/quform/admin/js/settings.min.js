var quform=function(e,s,a,t){"use strict";var i,n=e.core,o=n.cache,c=s(window),r=!1,f=null,b=!1,l=!1,d=!1;return i={init:function(){s.fn.tctabs&&(o.get("#qfb-settings-tabs").tctabs(".qfb-tabs-panel",{tabs:"> .qfb-tabs-nav > li",current:"qfb-current-tab"}),"#license-updates"===window.location.hash&&o.get("#qfb-settings-tabs").data("tabs").click(1),o.get("#qfb-custom-css-tabs").tctabs(".qfb-tabs-panel",{tabs:"> .qfb-tabs-nav > li",current:"qfb-current-tab"})),s("form.qfb-settings-form input").on("keydown",function(e){13==e.keyCode&&e.preventDefault()}),o.get("#qfb_load_scripts").change(function(){o.get("#qfb_load_scripts_custom").closest(n.settingWrap)["custom"==s(this).val()?"qfbSlideShow":"qfbSlideHide"]()}),s.fn.select2&&o.get("#qfb_locale").add(o.get("#qfb_load_scripts_custom")).select2({theme:"qfb",language:{noResults:function(){return t.noResultsFound}}}),o.get("#qfb-save-settings").add(o.get("#qfb-fixed-save-button")).click(function(){i.validateSettings()&&i.saveSettings()}),o.get("#qfb-settings-verify").click(i.verifyPurchaseCode),o.get("#qfb-settings-update").click(i.checkForUpdates),o.get("#qfb-rebuild-script-cache").click(i.rebuildScriptCache)},activateTab:function(e){o.get("#qfb-settings-tabs").data("tabs").click(e)},validateSettings:function(){s(".qfb-validation-error").remove();var e=[],a=s("#qfb_default_email_address"),o=a.val(),c="";n.isNonEmptyString(o)?n.isValidEmail(o)||(c=t.invalidEmailAddress):c=t.thisFieldIsRequired,c.length&&e.push({scrollTarget:a.closest(n.settingWrap),show:function(){n.addValidationError(a.closest(".qfb-settings-column"),c)},tab:0});var r=s("#qfb_default_from_email_address"),f=r.val(),b="";n.isNonEmptyString(f)?n.isValidEmail(f)||(b=t.invalidEmailAddress):b=t.thisFieldIsRequired,b.length&&e.push({scrollTarget:r.closest(n.settingWrap),show:function(){n.addValidationError(r.closest(".qfb-settings-column"),b)},tab:0});var l=0,d=e.length;if(d>0){for(i.activateTab(e[0].tab);l<d;l++)e[l].show();n.scrollTo(e[0].scrollTarget)}return 0===d},saveSettings:function(){r||(r=!0,o.get("#qfb-settings-save-loading").show().animate({maxWidth:"43px"}),"number"==typeof f&&(clearTimeout(f),f=null),o.get("#qfb-fixed-save-button").removeClass("qfb-saving qfb-saved qfb-save-error").addClass("qfb-saving"),s.ajax({type:"POST",url:t.ajaxUrl,data:{action:"quform_save_settings",_ajax_nonce:a.saveSettingsNonce,options:JSON.stringify(i.getSettings())},dataType:"json"}).done(function(e){"success"==(e=n.sanitiseResponse(e)).type?i.onSaveSuccess():i.onSaveError(e.message)}).fail(function(){i.onSaveError(t.ajaxError)}).always(function(){r=!1,o.get("#qfb-settings-save-loading").animate({maxWidth:"0"}).hide()}))},getSettings:function(){var e={defaultEmailAddress:s("#qfb_default_email_address").val(),defaultEmailName:s("#qfb_default_email_name").val(),defaultFromEmailAddress:s("#qfb_default_from_email_address").val(),defaultFromEmailName:s("#qfb_default_from_email_name").val(),locale:s("#qfb_locale").val(),dateFormatJs:s("#qfb_date_format_js").val(),timeFormatJs:s("#qfb_time_format_js").val(),dateFormat:s("#qfb_date_format").val(),timeFormat:s("#qfb_time_format").val(),rtl:s("#qfb_rtl").val(),recaptchaSiteKey:s("#qfb_recaptcha_site_key").val(),recaptchaSecretKey:s("#qfb_recaptcha_secret_key").val(),customCss:s("#qfb_custom_css").val(),customCssTablet:s("#qfb_custom_css_tablet").val(),customCssPhone:s("#qfb_custom_css_phone").val(),customJs:s("#qfb_custom_js").val(),loadScripts:s("#qfb_load_scripts").val(),loadScriptsCustom:s("#qfb_load_scripts_custom").val(),disabledStyles:{fontAwesome:!s("#qfb_enable_style_font_awesome").is(":checked"),select2:!s("#qfb_enable_style_select2").is(":checked"),qtip:!s("#qfb_enable_style_qtip").is(":checked"),fancybox:!s("#qfb_enable_style_fancybox").is(":checked"),fancybox2:!s("#qfb_enable_style_fancybox2").is(":checked"),magnificPopup:!s("#qfb_enable_style_magnific_popup").is(":checked")},disabledScripts:{fileUpload:!s("#qfb_enable_script_file_upload").is(":checked"),scrollTo:!s("#qfb_enable_script_scroll_to").is(":checked"),select2:!s("#qfb_enable_script_select2").is(":checked"),qtip:!s("#qfb_enable_script_qtip").is(":checked"),fancybox:!s("#qfb_enable_script_fancybox").is(":checked"),fancybox2:!s("#qfb_enable_script_fancybox2").is(":checked"),magnificPopup:!s("#qfb_enable_script_magnific_popup").is(":checked"),infieldLabels:!s("#qfb_enable_script_infield_labels").is(":checked"),datepicker:!s("#qfb_enable_script_datepicker").is(":checked"),timepicker:!s("#qfb_enable_script_timepicker").is(":checked")},combineCss:s("#qfb_combine_css").is(":checked"),combineJs:s("#qfb_combine_js").is(":checked"),popupEnabled:s("#qfb_popup_enabled").is(":checked"),popupScript:s("#qfb_popup_script").val(),rawFix:s("#qfb_raw_fix").is(":checked"),scrollOffset:s("#qfb_scroll_offset").val(),scrollSpeed:s("#qfb_scroll_speed").val(),allowAllFileTypes:s("#qfb_allow_all_file_types").is(":checked"),showEditLink:s("#qfb_show_edit_link").is(":checked"),csrfProtection:s("#qfb_csrf_protection").is(":checked"),toolbarMenu:s("#qfb_toolbar_menu").is(":checked"),dashboardWidget:s("#qfb_dashboard_widget").is(":checked"),insertFormButton:s("#qfb_insert_form_button").is(":checked"),preventFouc:s("#qfb_prevent_fouc").is(":checked"),secureApiRequests:s("#qfb_secure_api_requests").is(":checked"),referralEnabled:s("#qfb_referral_enabled").is(":checked"),referralText:s("#qfb_referral_text").val(),referralUsername:s("#qfb_referral_username").val()};return s.isArray(e.loadScriptsCustom)||(e.loadScriptsCustom=[]),e.permissions={},s(".qfb-permissions-capability").each(function(){var a=s(this),t=a.data("role"),i=a.data("capability");"undefined"==typeof e.permissions[t]&&(e.permissions[t]={}),e.permissions[t][i]=a.is(":checked")}),e},onSaveSuccess:function(){n.showFixedMessage(a.settingsSaved,"success"),o.get("#qfb-fixed-save-button").removeClass("qfb-saving").addClass("qfb-saved"),f=setTimeout(function(){o.get("#qfb-fixed-save-button").removeClass("qfb-saved")},2e3)},onSaveError:function(e){n.showFixedMessage(a.errorSavingSettings+"<br>"+e,"error"),o.get("#qfb-fixed-save-button").removeClass("qfb-saving").addClass("qfb-save-error"),f=setTimeout(function(){o.get("#qfb-fixed-save-button").removeClass("qfb-save-error")},2e3)},checkForUpdates:function(){b?alert(a.waitUpdating):(b=!0,o.get("#qfb-settings-update-loading").show().animate({maxWidth:"43px"}),s.ajax({type:"POST",url:t.ajaxUrl,data:{action:"quform_manual_update_check",_ajax_nonce:a.updateCheckNonce},dataType:"json"}).done(function(e){"success"==(e=n.sanitiseResponse(e)).type?i.onUpdateSuccess(e.message):i.onUpdateError(e.message)}).fail(function(){i.onUpdateError(t.ajaxError)}).always(function(){o.get("#qfb-settings-update-loading").animate({maxWidth:"0"}).hide(),b=!1}))},showUpdateMessage:function(e,s){o.get("#qfb-settings-update-message").hide(),o.get("#qfb-settings-update-message").find(".qfb-message-box").removeClass("qfb-message-box-success qfb-message-box-error").addClass("qfb-message-box-"+s),o.get("#qfb-settings-update-message").find(".qfb-message-box-inner").html(e),o.get("#qfb-settings-update-message").qfbSlideShow()},onUpdateSuccess:function(e){i.showUpdateMessage(e,"success")},onUpdateError:function(e){e=a.errorCheckingForUpdate+(e?" ("+e+")":""),i.showUpdateMessage(e,"error")},verifyPurchaseCode:function(){if(l)alert(a.waitVerifying);else{var e=s("#qfb_purchase_code").val();e.length&&(l=!0,o.get("#qfb-settings-verify-loading").show().animate({maxWidth:"43px"}),s.ajax({type:"POST",url:t.ajaxUrl,data:{action:"quform_verify_purchase_code",_ajax_nonce:a.verifyNonce,purchase_code:e},dataType:"json"}).done(function(e){if("success"==(e=n.sanitiseResponse(e)).type?i.onVerificationSuccess(e.message):"error"!=e.type&&"invalid"!=e.type||i.showVerificationMessage(e.message,"error"),"string"==typeof e.status){var t=s(".qfb-license-status"),o=t.find(".qfb-message-box");"valid"!==e.status&&"bundled"!==e.status||!o.hasClass("qfb-message-box-error")?"unlicensed"===e.status&&o.hasClass("qfb-message-box-success")&&t.fadeOut(function(){o.removeClass("qfb-message-box-success").addClass("qfb-message-box-error").find(".qfb-message-box-inner").text(a.unlicensed),t.fadeIn()}):t.fadeOut(function(){o.removeClass("qfb-message-box-error").addClass("qfb-message-box-success").find(".qfb-message-box-inner").text(a[e.status]),t.fadeIn()})}}).fail(function(){i.onVerificationError(t.ajaxError)}).always(function(){o.get("#qfb-settings-verify-loading").animate({maxWidth:"0"}).hide(),l=!1}))}},showVerificationMessage:function(e,s){o.get("#qfb-settings-verify-message").hide(),o.get("#qfb-settings-verify-message").find(".qfb-message-box").removeClass("qfb-message-box-success qfb-message-box-error").addClass("qfb-message-box-"+s),o.get("#qfb-settings-verify-message").find(".qfb-message-box-inner").html(e),o.get("#qfb-settings-verify-message").qfbSlideShow()},onVerificationSuccess:function(e){i.showVerificationMessage(e,"success")},onVerificationError:function(e){e=a.errorVerifying+(e?" ("+e+")":""),i.showVerificationMessage(e,"error")},rebuildScriptCache:function(){d||(d=!0,o.get("#qfb-rebuild-script-cache-loading").show().animate({maxWidth:"43px"}),s.ajax({type:"POST",url:t.ajaxUrl,data:{action:"quform_rebuild_script_cache",_ajax_nonce:a.rebuildScriptCacheNonce},dataType:"json"}).done(function(e){"success"==(e=n.sanitiseResponse(e)).type?n.showFixedMessage(a.scriptCacheRebuilt,"success"):i.onRebuildScriptCacheError(e.message)}).fail(function(){i.onRebuildScriptCacheError(t.ajaxError)}).always(function(){d=!1,o.get("#qfb-rebuild-script-cache-loading").animate({maxWidth:"0"}).hide()}))},onRebuildScriptCacheError:function(e){n.showFixedMessage(a.errorRebuildingScriptCache+"<br>"+e,"error")},onWindowLoad:function(){i.setupTooltips(),o.get("#qfb_popup_script").change(i.setDisableableScriptVisibility),o.get("#qfb_popup_enabled").click(function(){s("#qfb_popup_script").closest(n.settingWrap)[s(this).is(":checked")?"qfbSlideShow":"qfbSlideHide"](),i.setDisableableScriptVisibility()})},setupTooltips:function(){"function"==typeof s.fn.qtip&&s(".qfb-disableable-script-tooltip").qtip({show:{solo:!0},style:{classes:"qtip-dark qtip-dark-quform"},content:{text:function(){return s(this).find(".qfb-tooltip-content").html()}},position:{viewport:!0}})},setDisableableScriptVisibility:function(){if(o.get("#qfb_popup_enabled").is(":checked"))switch(o.get("#qfb_popup_script").val()){case"fancybox-2":o.get("#qfb_enable_style_fancybox").add(o.get("#qfb_enable_style_magnific_popup")).add(o.get("#qfb_enable_script_fancybox")).add(o.get("#qfb_enable_script_magnific_popup")).closest(".qfb-disableable-script").hide(),o.get("#qfb_enable_style_fancybox2").add(o.get("#qfb_enable_script_fancybox2")).closest(".qfb-disableable-script").show();break;case"fancybox-1":o.get("#qfb_enable_style_fancybox2").add(o.get("#qfb_enable_style_magnific_popup")).add(o.get("#qfb_enable_script_fancybox2")).add(o.get("#qfb_enable_script_magnific_popup")).closest(".qfb-disableable-script").hide(),o.get("#qfb_enable_style_fancybox").add(o.get("#qfb_enable_script_fancybox")).closest(".qfb-disableable-script").show();break;case"magnific-popup":o.get("#qfb_enable_style_fancybox").add(o.get("#qfb_enable_style_fancybox2")).add(o.get("#qfb_enable_script_fancybox")).add(o.get("#qfb_enable_script_fancybox2")).closest(".qfb-disableable-script").hide(),o.get("#qfb_enable_style_magnific_popup").add(o.get("#qfb_enable_script_magnific_popup")).closest(".qfb-disableable-script").show()}else o.get("#qfb_enable_style_fancybox").add(o.get("#qfb_enable_style_fancybox2")).add(o.get("#qfb_enable_style_magnific_popup")).add(o.get("#qfb_enable_script_fancybox")).add(o.get("#qfb_enable_script_fancybox2")).add(o.get("#qfb_enable_script_magnific_popup")).closest(".qfb-disableable-script").hide()}},s(document).ready(i.init),c.on("load",i.onWindowLoad),e.settings=i,e}(quform||{},jQuery,quformSettingsL10n,quformCoreL10n);