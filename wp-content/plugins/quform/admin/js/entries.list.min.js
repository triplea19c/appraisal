var quform=function(e,t,n,i){"use strict";function l(e){var n=t(this).closest(".qfb-entry-label-edit"),i=n.data("label");e=e&&e.isValid()?e.toString():"",n.css("background-color",e),i.color=e}function a(e){return s.saveEntryLabelName.call(this,e),r.htmlEntities(e)}var s,r=e.core,o=r.cache,c=t(document),b=!1,f={showInput:!0,allowEmpty:!1,showAlpha:!0,preferredFormat:"hex",move:l,change:l,beforeShow:function(){t(this).spectrum("set",t(this).closest(".qfb-entry-label-edit").data("label").color)}},d={onblur:"submit",onreset:function(e,t){s.saveEntryLabelName.call(t,r.htmlEntityDecode(t.revert))},placeholder:"",select:!0,height:"18px",data:function(e){return r.htmlEntityDecode(e)}};return s={init:function(){t("#the-list").find(".delete a").click(function(){return confirm(i.singleDeleteEntryMessage)}),t("#doaction").click(function(){return t('input[name="eids[]"]:checked').length>0&&("delete"==t("#bulk-action-selector-top").val()?confirm(i.pluralDeleteEntryMessage):void 0)}),t("#doaction2").click(function(){return t('input[name="eids[]"]:checked').length>0&&("delete"==t("#bulk-action-selector-bottom").val()?confirm(i.pluralDeleteEntryMessage):void 0)}),o.get("#qfb-show-entries-table-settings").click(function(){s.showTableSettings()}),o.get("#qfb-entries-table-settings").find(".qfb-popup-save-button").click(function(){s.saveTableSettings()}),o.get("#qfb-entries-table-settings").find(".qfb-popup-close-button").click(function(){s.hideTableSettings()}),o.get("#qfb-entries-table-settings").find(".qfb-popup-overlay").click(function(){s.hideTableSettings()}),o.get("#qfb_forms_per_page").on("keyup",function(e){e.keyCode&&13==e.keyCode&&s.saveTableSettings()}),o.get("#qfb-active-columns").sortable({connectWith:"#qfb-inactive-columns"}),o.get("#qfb-inactive-columns").sortable({connectWith:"#qfb-active-columns"}),t.fn.qtip&&t(".qfb-tooltip-icon").qtip({show:{solo:!0},style:{classes:"qtip-dark qtip-dark-quform"},content:{text:function(){return t(this).find(".qfb-tooltip-content").html()}},hide:{fixed:!0},position:{viewport:!0,container:o.get("#qfb-entries-table-settings-inner")}}),o.get("#qfb-entry-label-search-trigger").click(function(){o.get("#qfb-entry-label-search").is(":visible")?o.get("#qfb-entry-label-search").hide():o.get("#qfb-entry-label-search").show()}),c.on("click",function(){o.get("#qfb-entry-label-search").is(":visible")&&o.get("#qfb-entry-label-search").hide()}),o.get("#qfb-entry-label-search").add(o.get("#qfb-entry-label-search-trigger")).click(function(e){e.stopPropagation()}),o.get("#qfb-entry-label-search").on("click",".qfb-entry-label",function(){t(this).toggleClass("qfb-label-selected"),s.setSelectedSearchLabels()})},onWindowLoad:function(){o.get("#qfb-entry-labels-add").click(function(){var e={color:tinycolor.random().toString("hex"),name:""};o.get("#qfb-entry-labels-edit-empty").qfbSlideHide(function(){s.getEntryLabelEditHtml(e).hide().appendTo(o.get("#qfb-entry-labels-edit")).qfbSlideShow()})}),o.get("#qfb-entry-labels-edit").find(".qfb-entry-label-edit-name").editable(a,d),o.get("#qfb-entry-labels-edit").find(".qfb-entry-label-edit-action-color").spectrum(f),o.get("#qfb-entry-labels-edit").on("click",".qfb-entry-label-edit-action-duplicate",function(){var e=t(this).closest(".qfb-entry-label-edit"),n=e.data("label");e.after(s.getEntryLabelEditHtml({name:n.name,color:n.color}))}),o.get("#qfb-entry-labels-edit").on("click",".qfb-entry-label-edit-action-remove",function(){t(this).closest(".qfb-entry-label-edit").qfbSlideHide(function(){t(this).remove(),o.get("#qfb-entry-labels-edit").find(".qfb-entry-label-edit").length||o.get("#qfb-entry-labels-edit-empty").qfbSlideShow()})})},showTableSettings:function(){o.get("body").css("overflow","hidden"),o.get("#qfb-entries-table-settings").show()},hideTableSettings:function(){o.get("body").css("overflow",""),o.get("#qfb-entries-table-settings").hide(),o.get("#qfb-entries-table-settings").find(".qfb-submission-error").remove(),o.get("#qfb-entries-table-settings").find(".qfb-validation-error").remove()},saveTableSettings:function(){if(!b){b=!0,o.get("#qfb-entries-table-settings").find(".qfb-submission-error").remove(),o.get("#qfb-entries-table-settings").find(".qfb-validation-error").remove();var e=[];o.get("#qfb-active-columns").find("> div").each(function(){e.push(t(this).data("column"))});var l=[];o.get("#qfb-entry-labels-edit").find("> .qfb-entry-label-edit").each(function(){l.push(t(this).data("label"))}),t.ajax({url:n.ajaxUrl,type:"POST",dataType:"json",data:{action:"quform_save_entries_table_settings",_ajax_nonce:i.saveTableSettingsNonce,per_page:o.get("#qfb_entries_per_page").val(),columns:e,labels:l,id:o.get("#qfb_form_id").val()}}).done(function(e){if(e=r.sanitiseResponse(e),b=!1,"success"==e.type)window.location.reload();else if("error"==e.type||"invalid"==e.type){var n=[];e.message&&n.push(r.addSubmissionError(o.get("#qfb-entries-table-settings").find(".qfb-settings"),e.message)),e.errors&&t.each(e.errors,function(e,t){var i=o.get("#"+e).closest(r.settingInputWrap);r.addValidationError(i,t),n.push(i)}),n.length&&r.scrollTo(n[0],o.get("#qfb-entries-table-settings-inner"))}}).fail(function(){r.scrollTo(r.addSubmissionError(o.get("#qfb-entries-table-settings").find(".qfb-settings"),n.ajaxError),o.get("#qfb-entries-table-settings-inner")),b=!1})}},setSelectedSearchLabels:function(){var e=[];o.get("#qfb-entry-label-search").find(".qfb-label-selected").each(function(){e.push(""+t(this).data("id"))}),o.get("#qfb-entry-label-search-ids").find("> option").each(function(){var n=t(this);t.inArray(n.val(),e)>-1?n.prop("selected",!0):n.prop("selected",!1)})},getEntryLabelEditHtml:function(e){var n=t(i.entryLabelEditHtml);return n.find(".qfb-entry-label-edit-name").text(e.name).editable(a,d),n.css("background-color",e.color),n.data("label",e),n.find(".qfb-entry-label-edit-action-color").spectrum(f),n},saveEntryLabelName:function(e){t(this).closest(".qfb-entry-label-edit").data("label").name=e}},t(document).ready(s.init),t(window).on("load",s.onWindowLoad),e.entries=e.entries||{},e.entries.list=s,e}(quform,jQuery,quformCoreL10n,quformEntriesListL10n);