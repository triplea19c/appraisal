(typeof define=="function"&&define.amd?define:function(t,e,r){(r||e)()})("kendo.data",["kendo.core","kendo.data.odata","kendo.data.xml"],function(){return function(t,e){function r(t,e,r,i){return function(n){var s,a={};for(s in n)a[s]=n[s];a.field=i?r+"."+n.field:r,e==X&&t._notifyChange&&t._notifyChange(a),t.trigger(e,a)}}function i(e,r){if(e===r)return!0;var n,s=t.type(e);if(s!==t.type(r))return!1;if("date"===s)return e.getTime()===r.getTime();if("object"!==s&&"array"!==s)return!1;for(n in e)if(!i(e[n],r[n]))return!1;return!0}function n(t){this.data=t||[]}function s(t,r){if(t){var i=typeof t===K?{field:t,dir:r}:t,n=E(i)?i:i!==e?[i]:[];return H(n,function(t){return!!t.dir})}}function a(t){var e,r,i,n,s=t.filters;if(s)for(e=0,r=s.length;e<r;e++)(n=(i=s[e]).operator)&&typeof n===K&&(i.operator=qt[n.toLowerCase()]||n),a(i)}function o(t){if(t&&!B(t))return!E(t)&&t.filters||(t={logic:"and",filters:E(t)?t:[t]}),a(t),t}function h(t,e){return!t.logic&&!e.logic&&t.field===e.field&&t.value===e.value&&t.operator===e.operator}function u(t){return t=t||{},B(t)?{logic:"and",filters:[]}:o(t)}function l(t,e){return e.logic||t.field>e.field?1:t.field<e.field?-1:0}function d(t,e){if(t=u(t),e=u(e),t.logic!==e.logic)return!1;var r,i,n=(t.filters||[]).slice(),s=(e.filters||[]).slice();if(n.length!==s.length)return!1;n=n.sort(l),s=s.sort(l);for(var a=0;a<n.length;a++)if(r=n[a],i=s[a],r.logic&&i.logic){if(!d(r,i))return!1}else if(!h(r,i))return!1;return!0}function f(t,r){var i=typeof t===K?{field:t,dir:r}:t,n=E(i)?i:i!==e?[i]:[];return M(n,function(t){return{field:t.field,dir:t.dir||"asc",aggregates:t.aggregates}})}function c(t){return"number"==typeof t&&!isNaN(t)}function g(t){return t&&t.getTime}function p(t){var e,r=t.length,i=new Array(r);for(e=0;e<r;e++)i[e]=t[e].toJSON();return i}function _(t,e,r,i,n){var s,a,o,h,u,l={};for(h=0,u=t.length;h<u;h++){s=t[h];for(a in e)(o=n[a])&&o!==a&&(l[o]||(l[o]=V.setter(o)),l[o](s,e[a](s)),delete s[a])}}function v(t,e,r,i,n){var s,a,o,h,u;for(h=0,u=t.length;h<u;h++){s=t[h];for(a in e)s[a]=r._parse(a,e[a](s)),(o=n[a])&&o!==a&&delete s[o]}}function m(t,e,r,i,n){var s,a,o,h;for(a=0,h=t.length;a<h;a++)(o=i[(s=t[a]).field])&&o!=s.field&&(s.field=o),s.value=r._parse(s.field,s.value),s.hasSubgroups?m(s.items,e,r,i,n):v(s.items,e,r,0,n)}function y(t,e,r,i,n,s){return function(a){return(a=t(a))&&!B(i)&&("[object Array]"===ct.call(a)||a instanceof _t||(a=[a]),r(a,i,new e,n,s)),a||[]}}function S(t,e,r,i){for(var n,s,a=0;e.length&&i;){var o=(s=(n=e[a]).items).length;if(t&&t.field===n.field&&t.value===n.value?(t.hasSubgroups&&t.items.length?S(t.items[t.items.length-1],n.items,r,i):(s=s.slice(r,r+i),t.items=t.items.concat(s)),e.splice(a--,1)):n.hasSubgroups&&s.length?(S(n,s,r,i),n.items.length||e.splice(a--,1)):(s=s.slice(r,r+i),n.items=s,n.items.length||e.splice(a--,1)),0===s.length?r-=o:(r=0,i-=s.length),++a>=e.length)break}a<e.length&&e.splice(a,e.length-a)}function b(t){var e,r,i,n,s=[];for(e=0,r=t.length;e<r;e++){var a=t.at(e);if(a.hasSubgroups)s=s.concat(b(a.items));else for(i=a.items,n=0;n<i.length;n++)s.push(i.at(n))}return s}function w(t,e){var r,i,n;if(e)for(r=0,i=t.length;r<i;r++)(n=t.at(r)).hasSubgroups?w(n.items,e):n.items=new vt(n.items,e)}function k(t,e){for(var r=0,i=t.length;r<i;r++)if(t[r].hasSubgroups){if(k(t[r].items,e))return!0}else if(e(t[r].items,t[r]))return!0}function x(t,e,r,i){for(var n=0;n<t.length&&t[n].data!==e&&!q(t[n].data,r,i);n++);}function q(t,e,r){for(var i=0,n=t.length;i<n;i++){if(t[i]&&t[i].hasSubgroups)return q(t[i].items,e,r);if(t[i]===e||t[i]===r)return t[i]=r,!0}}function F(t,r,i,n,s){for(var a=0,o=t.length;a<o;a++){var h=t[a];if(h&&!(h instanceof n))if(h.hasSubgroups===e||s){for(var u=0;u<r.length;u++)if(r[u]===h){t[a]=r.at(u),x(i,r,h,t[a]);break}}else F(h.items,r,i,n,s)}}function R(t,e,r,i){var n,s=t.length,a=r||0,o=void 0!==i?st.min(a+i,s):s;for(n=a;n<o;n++){var h=t.at(n);if(h.uid==e.uid)return t.splice(n,1),h}}function D(t,e){return e?z(t,function(t){return t.uid&&t.uid==e.uid||t[e.idField]===e.id&&e.id!==e._defaultId}):-1}function O(t,e){return e?z(t,function(t){return t.uid==e.uid}):-1}function z(t,e){var r,i;for(r=0,i=t.length;r<i;r++)if(e(t[r]))return r;return-1}function P(t,e){if(t&&!B(t)){var r,i=t[e];return r=G(i)?i.from||i.field||e:t[e]||e,W(r)?e:r}return e}function C(t,e){var r,i,n={};for(var s in t)"filters"!==s&&(n[s]=t[s]);if(t.filters)for(n.filters=[],r=0,i=t.filters.length;r<i;r++)n.filters[r]=C(t.filters[r],e);else n.field=P(e.fields,n.field);return n}function T(t,e){var r,i,n,s,a=[];for(r=0,i=t.length;r<i;r++){n={},s=t[r];for(var o in s)n[o]=s[o];n.field=P(e.fields,n.field),n.aggregates&&E(n.aggregates)&&(n.aggregates=T(n.aggregates,e)),a.push(n)}return a}function A(t){return function(){var e=this._data,r=Pt.fn[t].apply(this,dt.call(arguments));return this._data!=e&&this._attachBubbleHandlers(),r}}function I(e,r){function i(t,e){return t.filter(e).add(t.find(e))}var n,s,a,o,h,u,l,d,f=t(e).children(),c=[],g=r[0].field,p=r[1]&&r[1].field,_=r[2]&&r[2].field,v=r[3]&&r[3].field;for(n=0,s=f.length;n<s;n++)a={_loaded:!0},u=(o=f.eq(n))[0].firstChild,e=(d=o.children()).filter("ul"),d=d.filter(":not(ul)"),(h=o.attr("data-id"))&&(a.id=h),u&&(a[g]=3==u.nodeType?u.nodeValue:d.text()),p&&(a[p]=i(d,"a").attr("href")),v&&(a[v]=i(d,"img").attr("src")),_&&(l=i(d,".k-sprite").prop("className"),a[_]=l&&t.trim(l.replace("k-sprite",""))),e.length&&(a.items=I(e.eq(0),r)),"true"==o.attr("data-hasChildren")&&(a.hasChildren=!0),c.push(a);return c}var M,N=t.extend,j=t.proxy,G=t.isPlainObject,B=t.isEmptyObject,E=t.isArray,H=t.grep,L=t.ajax,U=t.each,J=t.noop,V=window.kendo,W=V.isFunction,Q=V.Observable,$=V.Class,K="string",X="change",Y="requestStart",Z="progress",tt="requestEnd",et=["create","read","update","destroy"],rt=function(t){return t},it=V.getter,nt=V.stringify,st=Math,at=[].push,ot=[].join,ht=[].pop,ut=[].splice,lt=[].shift,dt=[].slice,ft=[].unshift,ct={}.toString,gt=V.support.stableSort,pt=/^\/Date\((.*?)\)\/$/,_t=Q.extend({init:function(t,e){this.type=e||mt,Q.fn.init.call(this),this.length=t.length,this.wrapAll(t,this)},at:function(t){return this[t]},toJSON:function(){var t,e,r=this.length,i=new Array(r);for(t=0;t<r;t++)(e=this[t])instanceof mt&&(e=e.toJSON()),i[t]=e;return i},parent:J,wrapAll:function(t,e){var r,i,n=this,s=function(){return n};for(e=e||[],r=0,i=t.length;r<i;r++)e[r]=n.wrap(t[r],s);return e},wrap:function(t,e){var r=this;return null!==t&&"[object Object]"===ct.call(t)&&(t instanceof r.type||t instanceof bt||(t=t instanceof mt?t.toJSON():t,t=new r.type(t)),t.parent=e,t.bind(X,function(t){r.trigger(X,{field:t.field,node:t.node,index:t.index,items:t.items||[this],action:t.node?t.action||"itemloaded":"itemchange"})})),t},push:function(){var t,e=this.length,r=this.wrapAll(arguments);return t=at.apply(this,r),this.trigger(X,{action:"add",index:e,items:r}),t},slice:dt,sort:[].sort,join:ot,pop:function(){var t=this.length,e=ht.apply(this);return t&&this.trigger(X,{action:"remove",index:t-1,items:[e]}),e},splice:function(t,e,r){var i,n,s,a=this.wrapAll(dt.call(arguments,2));if((i=ut.apply(this,[t,e].concat(a))).length)for(this.trigger(X,{action:"remove",index:t,items:i}),n=0,s=i.length;n<s;n++)i[n]&&i[n].children&&i[n].unbind(X);return r&&this.trigger(X,{action:"add",index:t,items:a}),i},shift:function(){var t=this.length,e=lt.apply(this);return t&&this.trigger(X,{action:"remove",index:0,items:[e]}),e},unshift:function(){var t,e=this.wrapAll(arguments);return t=ft.apply(this,e),this.trigger(X,{action:"add",index:0,items:e}),t},indexOf:function(t){var e,r;for(e=0,r=this.length;e<r;e++)if(this[e]===t)return e;return-1},forEach:function(t){for(var e=0,r=this.length;e<r;e++)t(this[e],e,this)},map:function(t){for(var e=0,r=[],i=this.length;e<i;e++)r[e]=t(this[e],e,this);return r},reduce:function(t){var e,r=0,i=this.length;for(2==arguments.length?e=arguments[1]:r<i&&(e=this[r++]);r<i;r++)e=t(e,this[r],r,this);return e},reduceRight:function(t){var e,r=this.length-1;for(2==arguments.length?e=arguments[1]:r>0&&(e=this[r--]);r>=0;r--)e=t(e,this[r],r,this);return e},filter:function(t){for(var e,r=0,i=[],n=this.length;r<n;r++)t(e=this[r],r,this)&&(i[i.length]=e);return i},find:function(t){for(var e,r=0,i=this.length;r<i;r++)if(e=this[r],t(e,r,this))return e},every:function(t){for(var e,r=0,i=this.length;r<i;r++)if(e=this[r],!t(e,r,this))return!1;return!0},some:function(t){for(var e,r=0,i=this.length;r<i;r++)if(e=this[r],t(e,r,this))return!0;return!1},remove:function(t){var e=this.indexOf(t);-1!==e&&this.splice(e,1)},empty:function(){this.splice(0,this.length)}});"undefined"!=typeof Symbol&&Symbol.iterator&&!_t.prototype[Symbol.iterator]&&(_t.prototype[Symbol.iterator]=[][Symbol.iterator]);var vt=_t.extend({init:function(t,e){Q.fn.init.call(this),this.type=e||mt;for(var r=0;r<t.length;r++)this[r]=t[r];this.length=r,this._parent=j(function(){return this},this)},at:function(t){var e=this[t];return e instanceof this.type?e.parent=this._parent:e=this[t]=this.wrap(e,this._parent),e}}),mt=Q.extend({init:function(t){var e,r,i=this,n=function(){return i};Q.fn.init.call(this),this._handlers={};for(r in t)"object"==typeof(e=t[r])&&e&&!e.getTime&&"_"!=r.charAt(0)&&(e=i.wrap(e,r,n)),i[r]=e;i.uid=V.guid()},shouldSerialize:function(t){return this.hasOwnProperty(t)&&"_handlers"!==t&&"_events"!==t&&"function"!=typeof this[t]&&"uid"!==t},forEach:function(t){for(var e in this)this.shouldSerialize(e)&&t(this[e],e)},toJSON:function(){var t,e,r={};for(e in this)this.shouldSerialize(e)&&(((t=this[e])instanceof mt||t instanceof _t)&&(t=t.toJSON()),r[e]=t);return r},get:function(t){return this.trigger("get",{field:t}),"this"===t?this:V.getter(t,!0)(this)},_set:function(t,e){var r=t.indexOf(".")>=0;if(r)for(var i=t.split("."),n="";i.length>1;){n+=i.shift();var s=V.getter(n,!0)(this);if(s instanceof mt)return s.set(i.join("."),e),r;n+="."}return V.setter(t)(this,e),r},set:function(t,e){var r=this,i=!1,n=t.indexOf(".")>=0,s=V.getter(t,!0)(r);return s!==e&&(s instanceof Q&&this._handlers[t]&&(this._handlers[t].get&&s.unbind("get",this._handlers[t].get),s.unbind(X,this._handlers[t].change)),(i=r.trigger("set",{field:t,value:e}))||(n||(e=r.wrap(e,t,function(){return r})),(!r._set(t,e)||t.indexOf("(")>=0||t.indexOf("[")>=0)&&r.trigger(X,{field:t}))),i},parent:J,wrap:function(t,e,i){var n,s,a=ct.call(t);if(null!=t&&("[object Object]"===a||"[object Array]"===a)){var o=t instanceof _t,h=t instanceof Pt;"[object Object]"!==a||h||o?("[object Array]"===a||o||h)&&(o||h||(t=new _t(t)),s=r(this,X,e,!1),t.bind(X,s),this._handlers[e]={change:s}):(t instanceof mt||(t=new mt(t)),n=r(this,"get",e,!0),t.bind("get",n),s=r(this,X,e,!0),t.bind(X,s),this._handlers[e]={get:n,change:s}),t.parent=i}return t}}),yt={number:function(t){return V.parseFloat(t)},date:function(t){return V.parseDate(t)},"boolean":function(t){return typeof t===K?"true"===t.toLowerCase():null!=t?!!t:t},string:function(t){return null!=t?t+"":t},"default":function(t){return t}},St={string:"",number:0,date:new Date,"boolean":!1,"default":""},bt=mt.extend({init:function(r){if((!r||t.isEmptyObject(r))&&(r=t.extend({},this.defaults,r),this._initializers))for(var i=0;i<this._initializers.length;i++){var n=this._initializers[i];r[n]=this.defaults[n]()}mt.fn.init.call(this,r),this.dirty=!1,this.dirtyFields={},this.idField&&(this.id=this.get(this.idField),this.id===e&&(this.id=this._defaultId))},shouldSerialize:function(t){return mt.fn.shouldSerialize.call(this,t)&&"uid"!==t&&!("id"!==this.idField&&"id"===t)&&"dirty"!==t&&"dirtyFields"!==t&&"_accessors"!==t},_parse:function(t,e){var r,i=t,n=this.fields||{};return(t=n[t])||(t=function(t,e){var r,i;for(i in t){if(r=t[i],G(r)&&r.field&&r.field===e)return r;if(r===e)return r}return null}(n,i)),t&&!(r=t.parse)&&t.type&&(r=yt[t.type.toLowerCase()]),r?r(e):e},_notifyChange:function(t){var e=t.action;"add"!=e&&"remove"!=e||(this.dirty=!0,this.dirtyFields[t.field]=!0)},editable:function(t){return!(t=(this.fields||{})[t])||!1!==t.editable},set:function(t,e,r){var n=this.dirty;this.editable(t)&&(i(e=this._parse(t,e),this.get(t))||(this.dirty=!0,this.dirtyFields[t]=!0,mt.fn.set.call(this,t,e,r)&&!n&&(this.dirty=n,this.dirty||(this.dirtyFields[t]=!1))))},accept:function(t){var e,r=this,i=function(){return r};for(e in t){var n=t[e];"_"!=e.charAt(0)&&(n=r.wrap(t[e],e,i)),r._set(e,n)}r.idField&&(r.id=r.get(r.idField)),r.dirty=!1,r.dirtyFields={}},isNew:function(){return this.id===this._defaultId}});bt.define=function(t,r){r===e&&(r=t,t=bt);var i,n,s,a,o,h,u,l,d=N({defaults:{}},r),f={},c=d.id,g=[];if(c&&(d.idField=c),d.id&&delete d.id,c&&(d.defaults[c]=d._defaultId=""),"[object Array]"===ct.call(d.fields)){for(h=0,u=d.fields.length;h<u;h++)typeof(s=d.fields[h])===K?f[s]={}:s.field&&(f[s.field]=s);d.fields=f}for(n in d.fields)a=(s=d.fields[n]).type||"default",o=null,l=n,n=typeof s.field===K?s.field:n,s.nullable||"function"==typeof(o=d.defaults[l!==n?l:n]=s.defaultValue!==e?s.defaultValue:St[a.toLowerCase()])&&g.push(n),r.id===n&&(d._defaultId=o),d.defaults[l!==n?l:n]=o,s.parse=s.parse||yt[a];return g.length>0&&(d._initializers=g),i=t.extend(d),i.define=function(t){return bt.define(i,t)},d.fields&&(i.fields=d.fields,i.idField=d.idField),i};var wt={selector:function(t){return W(t)?t:it(t)},compare:function(t){var e=this.selector(t);return function(t,r){return t=e(t),r=e(r),null==t&&null==r?0:null==t?-1:null==r?1:t.localeCompare?t.localeCompare(r):t>r?1:t<r?-1:0}},create:function(t){var e=t.compare||this.compare(t.field);return"desc"==t.dir?function(t,r){return e(r,t,!0)}:e},combine:function(t){return function(e,r){var i,n,s=t[0](e,r);for(i=1,n=t.length;i<n;i++)s=s||t[i](e,r);return s}}},kt=N({},wt,{asc:function(t){var e=this.selector(t);return function(t,r){var i=e(t),n=e(r);return i&&i.getTime&&n&&n.getTime&&(i=i.getTime(),n=n.getTime()),i===n?t.__position-r.__position:null==i?-1:null==n?1:i.localeCompare?i.localeCompare(n):i>n?1:-1}},desc:function(t){var e=this.selector(t);return function(t,r){var i=e(t),n=e(r);return i&&i.getTime&&n&&n.getTime&&(i=i.getTime(),n=n.getTime()),i===n?t.__position-r.__position:null==i?1:null==n?-1:n.localeCompare?n.localeCompare(i):i<n?1:-1}},create:function(t){return this[t.dir](t.field)}});M=function(t,e){var r,i=t.length,n=new Array(i);for(r=0;r<i;r++)n[r]=e(t[r],r,t);return n};var xt=function(){function t(t){return"string"==typeof t&&(t=t.replace(/[\r\n]+/g,"")),JSON.stringify(t)}function e(e){return function(r,i,n){return i+="",n&&(r="("+r+" || '').toLowerCase()",i=i.toLowerCase()),e(r,t(i),n)}}function r(e,r,i,n){if(null!=i){if(typeof i===K){var s=pt.exec(i);s?i=new Date(+s[1]):n?(i=t(i.toLowerCase()),r="(("+r+" || '')+'').toLowerCase()"):i=t(i)}i.getTime&&(r="("+r+"&&"+r+".getTime?"+r+".getTime():"+r+")",i=i.getTime())}return r+" "+e+" "+i}function i(t){for(var e="/^",r=!1,i=0;i<t.length;++i){var n=t.charAt(i);if(r)e+="\\"+n;else{if("~"==n){r=!0;continue}"*"==n?e+=".*":"?"==n?e+=".":".+^$()[]{}|\\/\n\r\u2028\u2029Â ".indexOf(n)>=0?e+="\\"+n:e+=n}r=!1}return e+"$/"}return{quote:function(e){return e&&e.getTime?"new Date("+e.getTime()+")":t(e)},eq:function(t,e,i){return r("==",t,e,i)},neq:function(t,e,i){return r("!=",t,e,i)},gt:function(t,e,i){return r(">",t,e,i)},gte:function(t,e,i){return r(">=",t,e,i)},lt:function(t,e,i){return r("<",t,e,i)},lte:function(t,e,i){return r("<=",t,e,i)},startswith:e(function(t,e){return t+".lastIndexOf("+e+", 0) == 0"}),doesnotstartwith:e(function(t,e){return t+".lastIndexOf("+e+", 0) == -1"}),endswith:e(function(t,e){return t+".indexOf("+e+", "+t+".length - "+(e?e.length-2:0)+") >= 0"}),doesnotendwith:e(function(t,e){return t+".indexOf("+e+", "+t+".length - "+(e?e.length-2:0)+") < 0"}),contains:e(function(t,e){return t+".indexOf("+e+") >= 0"}),doesnotcontain:e(function(t,e){return t+".indexOf("+e+") == -1"}),matches:e(function(t,e){return e=e.substring(1,e.length-1),i(e)+".test("+t+")"}),doesnotmatch:e(function(t,e){return e=e.substring(1,e.length-1),"!"+i(e)+".test("+t+")"}),isempty:function(t){return t+" === ''"},isnotempty:function(t){return t+" !== ''"},isnull:function(t){return"("+t+" == null)"},isnotnull:function(t){return"("+t+" != null)"}}}();n.filterExpr=function(t){var r,i,s,a,o,h,u=[],l=[],d=[],f=t.filters;for(r=0,i=f.length;r<i;r++)o=(s=f[r]).field,h=s.operator,s.filters?(s=(a=n.filterExpr(s)).expression.replace(/__o\[(\d+)\]/g,function(t,e){return e=+e,"__o["+(d.length+e)+"]"}).replace(/__f\[(\d+)\]/g,function(t,e){return e=+e,"__f["+(l.length+e)+"]"}),d.push.apply(d,a.operators),l.push.apply(l,a.fields)):("function"==typeof o?(a="__f["+l.length+"](d)",l.push(o)):a=V.expr(o),"function"==typeof h?(s="__o["+d.length+"]("+a+", "+xt.quote(s.value)+")",d.push(h)):s=xt[(h||"eq").toLowerCase()](a,s.value,s.ignoreCase===e||s.ignoreCase)),u.push(s);return{expression:"("+u.join({and:" && ",or:" || "}[t.logic])+")",fields:l,operators:d}};var qt={"==":"eq",equals:"eq",isequalto:"eq",equalto:"eq",equal:"eq","!=":"neq",ne:"neq",notequals:"neq",isnotequalto:"neq",notequalto:"neq",notequal:"neq","<":"lt",islessthan:"lt",lessthan:"lt",less:"lt","<=":"lte",le:"lte",islessthanorequalto:"lte",lessthanequal:"lte",">":"gt",isgreaterthan:"gt",greaterthan:"gt",greater:"gt",">=":"gte",isgreaterthanorequalto:"gte",greaterthanequal:"gte",ge:"gte",notsubstringof:"doesnotcontain",isnull:"isnull",isempty:"isempty",isnotempty:"isnotempty"};n.normalizeFilter=o,n.compareFilters=d,n.prototype={toArray:function(){return this.data},range:function(t,e){return new n(this.data.slice(t,t+e))},skip:function(t){return new n(this.data.slice(t))},take:function(t){return new n(this.data.slice(0,t))},select:function(t){return new n(M(this.data,t))},order:function(t,e,r){var i={dir:e};return t&&(t.compare?i.compare=t.compare:i.field=t),new n(r?this.data.sort(wt.create(i)):this.data.slice(0).sort(wt.create(i)))},orderBy:function(t,e){return this.order(t,"asc",e)},orderByDescending:function(t,e){return this.order(t,"desc",e)},sort:function(t,e,r,i){var n,a,o=s(t,e),h=[];if(r=r||wt,o.length){for(n=0,a=o.length;n<a;n++)h.push(r.create(o[n]));return this.orderBy({compare:r.combine(h)},i)}return this},filter:function(t){var e,r,i,s,a,h,u,l,d=this.data,f=[];if(!(t=o(t))||0===t.filters.length)return this;for(s=n.filterExpr(t),h=s.fields,u=s.operators,a=l=new Function("d, __f, __o","return "+s.expression),(h.length||u.length)&&(l=function(t){return a(t,h,u)}),e=0,i=d.length;e<i;e++)l(r=d[e])&&f.push(r);return new n(f)},group:function(t,e){t=f(t||[]),e=e||this.data;var r,i=new n(this.data);return t.length>0&&(r=t[0],i=i.groupBy(r).select(function(i){var s=new n(e).filter([{field:i.field,operator:"eq",value:i.value,ignoreCase:!1}]);return{field:i.field,value:i.value,items:t.length>1?new n(i.items).group(t.slice(1),s.toArray()).toArray():i.items,hasSubgroups:t.length>1,aggregates:s.aggregate(r.aggregates)}})),i},groupBy:function(t){if(B(t)||!this.data.length)return new n([]);var e,r,i,s,a=t.field,o=this._sortForGrouping(a,t.dir||"asc"),h=V.accessor(a),u=h.get(o[0],a),l={field:a,value:u,items:[]},d=[l];for(i=0,s=o.length;i<s;i++)e=o[i],function(t,e){return t&&t.getTime&&e&&e.getTime?t.getTime()===e.getTime():t===e}(u,r=h.get(e,a))||(l={field:a,value:u=r,items:[]},d.push(l)),l.items.push(e);return new n(d)},_sortForGrouping:function(t,e){var r,i,s=this.data;if(!gt){for(r=0,i=s.length;r<i;r++)s[r].__position=r;for(r=0,i=(s=new n(s).sort(t,e,kt).toArray()).length;r<i;r++)delete s[r].__position;return s}return this.sort(t,e).toArray()},aggregate:function(t){var e,r,i={},n={};if(t&&t.length)for(e=0,r=this.data.length;e<r;e++)!function(t,e,r,i,n,s){var a,o,h,u=(e=e||[]).length;for(a=0;a<u;a++){h=(o=e[a]).aggregate;var l=o.field;t[l]=t[l]||{},s[l]=s[l]||{},s[l][h]=s[l][h]||{},t[l][h]=Ft[h.toLowerCase()](t[l][h],r,V.accessor(l),i,n,s[l][h])}}(i,t,this.data[e],e,r,n);return i}};var Ft={sum:function(t,e,r){var i=r.get(e);return c(t)?c(i)&&(t+=i):t=i,t},count:function(t){return(t||0)+1},average:function(t,r,i,n,s,a){var o=i.get(r);return a.count===e&&(a.count=0),c(t)?c(o)&&(t+=o):t=o,c(o)&&a.count++,n==s-1&&c(t)&&(t/=a.count),t},max:function(t,e,r){var i=r.get(e);return c(t)||g(t)||(t=i),t<i&&(c(i)||g(i))&&(t=i),t},min:function(t,e,r){var i=r.get(e);return c(t)||g(t)||(t=i),t>i&&(c(i)||g(i))&&(t=i),t}};n.process=function(t,r,i){r=r||{};var a,o=new n(t),h=r.group,u=f(h||[]).concat(s(r.sort||[])),l=r.filterCallback,d=r.filter,c=r.skip,g=r.take;return d&&(o=o.filter(d),l&&(o=l(o)),a=o.toArray().length),u&&(o=i?o.sort(u,e,e,i):o.sort(u),h&&(t=o.toArray())),c!==e&&g!==e&&(o=o.range(c,g)),h&&(o=o.group(h,t)),{total:a,data:o.toArray()}};var Rt=$.extend({init:function(t){this.data=t.data},read:function(t){t.success(this.data)},update:function(t){t.success(t.data)},create:function(t){t.success(t.data)},destroy:function(t){t.success(t.data)}}),Dt=$.extend({init:function(t){var e;t=this.options=N({},this.options,t),U(et,function(e,r){typeof t[r]===K&&(t[r]={url:t[r]})}),this.cache=t.cache?Ot.create(t.cache):{find:J,add:J},e=t.parameterMap,W(t.push)&&(this.push=t.push),this.push||(this.push=rt),this.parameterMap=W(e)?e:function(t){var r={};return U(t,function(t,i){t in e&&(t=e[t],G(t)&&(i=t.value(i),t=t.key)),r[t]=i}),r}},options:{parameterMap:rt},create:function(t){return L(this.setup(t,"create"))},read:function(r){var i,n,s=this.cache;r=this.setup(r,"read"),i=r.success||J,r.error,(n=s.find(r.data))!==e?i(n):(r.success=function(t){s.add(r.data,t),i(t)},t.ajax(r))},update:function(t){return L(this.setup(t,"update"))},destroy:function(t){return L(this.setup(t,"destroy"))},setup:function(t,e){t=t||{};var r,i=this.options[e],n=W(i.data)?i.data(t.data):i.data;return t=N(!0,{},i,t),r=N(!0,{},n,t.data),t.data=this.parameterMap(r,e),W(t.url)&&(t.url=t.url(r)),t}}),Ot=$.extend({init:function(){this._store={}},add:function(t,r){t!==e&&(this._store[nt(t)]=r)},find:function(t){return this._store[nt(t)]},clear:function(){this._store={}},remove:function(t){delete this._store[nt(t)]}});Ot.create=function(t){var e={inmemory:function(){return new Ot}};return G(t)&&W(t.find)?t:!0===t?new Ot:e[t]()};var zt=$.extend({init:function(t){var e,r,i,n;t=t||{};for(e in t)r=t[e],this[e]=typeof r===K?it(r):r;n=t.modelBase||bt,G(this.model)&&(this.model=i=n.define(this.model));var s=j(this.data,this);if(this._dataAccessFunction=s,this.model){var a,o=j(this.groups,this),h=j(this.serialize,this),u={},l={},d={},f={},c=!1;(i=this.model).fields&&(U(i.fields,function(t,e){var r;a=t,G(e)&&e.field?a=e.field:typeof e===K&&(a=e),G(e)&&e.from&&(r=e.from),c=c||r&&r!==t||a!==t,l[t]=it(r||a),d[t]=it(t),u[r||a]=t,f[t]=r||a}),!t.serialize&&c&&(this.serialize=y(h,i,_,d,u,f))),this._dataAccessFunction=s,this.data=y(s,i,v,l,u,f),this.groups=y(o,i,m,l,u,f)}},errors:function(t){return t?t.errors:null},parse:rt,data:rt,total:function(t){return t.length},groups:rt,aggregates:function(){return{}},serialize:function(t){return t}}),Pt=Q.extend({init:function(t){var r,i=this;if(t&&(r=t.data),t=i.options=N({},i.options,t),i._map={},i._prefetch={},i._data=[],i._pristineData=[],i._ranges=[],i._view=[],i._pristineTotal=0,i._destroyed=[],i._pageSize=t.pageSize,i._page=t.page||(t.pageSize?1:e),i._sort=s(t.sort),i._filter=o(t.filter),i._group=f(t.group),i._aggregate=t.aggregate,i._total=t.total,i._shouldDetachObservableParents=!0,Q.fn.init.call(i),i.transport=Ct.create(t,r,i),W(i.transport.push)&&i.transport.push({pushCreate:j(i._pushCreate,i),pushUpdate:j(i._pushUpdate,i),pushDestroy:j(i._pushDestroy,i)}),null!=t.offlineStorage)if("string"==typeof t.offlineStorage){var n=t.offlineStorage;i._storage={getItem:function(){return JSON.parse(localStorage.getItem(n))},setItem:function(t){localStorage.setItem(n,nt(i.reader.serialize(t)))}}}else i._storage=t.offlineStorage;i.reader=new V.data.readers[t.schema.type||"json"](t.schema),i.reader.model,i._detachObservableParents(),i._data=i._observe(i._data),i._online=!0,i.bind(["push","error",X,Y,"sync",tt,Z],t)},options:{data:null,schema:{modelBase:bt},offlineStorage:null,serverSorting:!1,serverPaging:!1,serverFiltering:!1,serverGrouping:!1,serverAggregates:!1,batch:!1,inPlaceSort:!1},clone:function(){return this},online:function(r){return r!==e?this._online!=r&&(this._online=r,r)?this.sync():t.Deferred().resolve().promise():this._online},offlineData:function(t){return null==this.options.offlineStorage?null:t!==e?this._storage.setItem(t):this._storage.getItem()||[]},_isServerGrouped:function(){var t=this.group()||[];return this.options.serverGrouping&&t.length},_pushCreate:function(t){this._push(t,"pushCreate")},_pushUpdate:function(t){this._push(t,"pushUpdate")},_pushDestroy:function(t){this._push(t,"pushDestroy")},_push:function(t,e){var r=this._readData(t);r||(r=t),this[e](r)},_flatData:function(t,e){if(t){if(this._isServerGrouped())return b(t);if(!e)for(var r=0;r<t.length;r++)t.at(r)}return t},parent:J,get:function(t){var e,r,i=this._flatData(this._data,this.options.useRanges);for(e=0,r=i.length;e<r;e++)if(i[e].id==t)return i[e]},getByUid:function(t){return this._getByUid(t,this._data)},_getByUid:function(t,e){var r,i,n=this._flatData(e,this.options.useRanges);if(n)for(r=0,i=n.length;r<i;r++)if(n[r].uid==t)return n[r]},indexOf:function(t){return O(this._data,t)},at:function(t){return this._data.at(t)},data:function(t){if(t===e){if(this._data)for(var r=0;r<this._data.length;r++)this._data.at(r);return this._data}this._detachObservableParents(),this._data=this._observe(t),this._pristineData=t.slice(0),this._storeData(),this._ranges=[],this.trigger("reset"),this._addRange(this._data),this._total=this._data.length,this._pristineTotal=this._total,this._process(this._data)},view:function(t){if(t===e)return this._view;this._view=this._observeView(t)},_observeView:function(t){var e=this;F(t,e._data,e._ranges,e.reader.model||mt,e._isServerGrouped());var r=new vt(t,e.reader.model);return r.parent=function(){return e.parent()},r},flatView:function(){return(this.group()||[]).length?b(this._view):this._view},add:function(t){return this.insert(this._data.length,t)},_createNewModel:function(t){return this.reader.model?new this.reader.model(t):t instanceof mt?t:new mt(t)},insert:function(t,e){return e||(e=t,t=0),e instanceof bt||(e=this._createNewModel(e)),this._isServerGrouped()?this._data.splice(t,0,this._wrapInEmptyGroup(e)):this._data.splice(t,0,e),this._insertModelInRange(t,e),e},pushInsert:function(t,e){e||(e=t,t=0),E(e)||(e=[e]);var r=[],i=this.options.autoSync;this.options.autoSync=!1;try{for(var n=0;n<e.length;n++){var s=e[n],a=this.insert(t,s);r.push(a);var o=a.toJSON();this._isServerGrouped()&&(o=this._wrapInEmptyGroup(o)),this._pristineData.push(o),t++}}finally{this.options.autoSync=i}r.length&&this.trigger("push",{type:"create",items:r})},pushCreate:function(t){this.pushInsert(this._data.length,t)},pushUpdate:function(t){E(t)||(t=[t]);for(var e=[],r=0;r<t.length;r++){var i=t[r],n=this._createNewModel(i),s=this.get(n.id);s?(e.push(s),s.accept(i),s.trigger(X),this._updatePristineForModel(s,i)):this.pushCreate(i)}e.length&&this.trigger("push",{type:"update",items:e})},pushDestroy:function(t){var e=this._removeItems(t);e.length&&this.trigger("push",{type:"destroy",items:e})},_removeItems:function(t){E(t)||(t=[t]);var e=[],r=this.options.autoSync;this.options.autoSync=!1;try{for(var i=0;i<t.length;i++){var n=t[i],s=this._createNewModel(n),a=!1;this._eachItem(this._data,function(t){for(var r=0;r<t.length;r++){var i=t.at(r);if(i.id===s.id){e.push(i),t.splice(r,1),a=!0;break}}}),a&&(this._removePristineForModel(s),this._destroyed.pop())}}finally{this.options.autoSync=r}return e},remove:function(t){var e,r=this,i=r._isServerGrouped();return this._eachItem(r._data,function(n){if((e=r.options.useRanges&&!r.options.serverPaging?R(n,t,r.currentRangeStart(),r.take()):R(n,t))&&i)return e.isNew&&e.isNew()||r._destroyed.push(e),!0}),this._removeModelFromRanges(t),t},destroyed:function(){return this._destroyed},created:function(){var t,e,r=[],i=this._flatData(this._data,this.options.useRanges);for(t=0,e=i.length;t<e;t++)i[t].isNew&&i[t].isNew()&&r.push(i[t]);return r},updated:function(){var t,e,r=[],i=this._flatData(this._data,this.options.useRanges);for(t=0,e=i.length;t<e;t++)i[t].isNew&&!i[t].isNew()&&i[t].dirty&&r.push(i[t]);return r},sync:function(){var e=this,r=[],i=[],n=e._destroyed,s=t.Deferred().resolve().promise();if(e.online()){if(!e.reader.model)return s;r=e.created(),i=e.updated();var a=[];e.options.batch&&e.transport.submit?a=e._sendSubmit(r,i,n):(a.push.apply(a,e._send("create",r)),a.push.apply(a,e._send("update",i)),a.push.apply(a,e._send("destroy",n))),s=t.when.apply(null,a).then(function(){var t,r;for(t=0,r=arguments.length;t<r;t++)arguments[t]&&e._accept(arguments[t]);e._storeData(!0),e._change({action:"sync"}),e.trigger("sync")})}else e._storeData(!0),e._change({action:"sync"});return s},cancelChanges:function(t){t instanceof V.data.Model?this._cancelModel(t):(this._destroyed=[],this._detachObservableParents(),this._data=this._observe(this._pristineData),this.options.serverPaging&&(this._total=this._pristineTotal),this._ranges=[],this._addRange(this._data,0),this._change(),this._markOfflineUpdatesAsDirty())},_markOfflineUpdatesAsDirty:function(){null!=this.options.offlineStorage&&this._eachItem(this._data,function(t){for(var e=0;e<t.length;e++){var r=t.at(e);"update"!=r.__state__&&"create"!=r.__state__||(r.dirty=!0)}})},hasChanges:function(){var t,e,r=this._flatData(this._data,this.options.useRanges);if(this._destroyed.length)return!0;for(t=0,e=r.length;t<e;t++)if(r[t].isNew&&r[t].isNew()||r[t].dirty)return!0;return!1},_accept:function(e){var r,i=e.models,n=e.response,s=0,a=this._isServerGrouped(),o=this._pristineData,h=e.type;if(this.trigger(tt,{response:n,type:h}),n&&!B(n)){if(n=this.reader.parse(n),this._handleCustomErrors(n))return;n=this.reader.data(n),E(n)||(n=[n])}else n=t.map(i,function(t){return t.toJSON()});for("destroy"===h&&(this._destroyed=[]),s=0,r=i.length;s<r;s++)"destroy"!==h?(i[s].accept(n[s]),"create"===h?o.push(a?this._wrapInEmptyGroup(i[s]):n[s]):"update"===h&&this._updatePristineForModel(i[s],n[s])):this._removePristineForModel(i[s])},_updatePristineForModel:function(t,e){this._executeOnPristineForModel(t,function(t,r){V.deepExtend(r[t],e)})},_executeOnPristineForModel:function(t,e){this._eachPristineItem(function(r){var i=D(r,t);if(i>-1)return e(i,r),!0})},_removePristineForModel:function(t){this._executeOnPristineForModel(t,function(t,e){e.splice(t,1)})},_readData:function(t){return(this._isServerGrouped()?this.reader.groups:this.reader.data).call(this.reader,t)},_eachPristineItem:function(t){this._eachItem(this._pristineData,t)},_eachItem:function(t,e){t&&t.length&&(this._isServerGrouped()?k(t,e):e(t))},_pristineForModel:function(t){var e,r;return this._eachPristineItem(function(i){if((r=D(i,t))>-1)return e=i[r],!0}),e},_cancelModel:function(t){var e=this,r=this._pristineForModel(t);this._eachItem(this._data,function(i){var n=O(i,t);n>=0&&(!r||t.isNew()&&!r.__state__?(i.splice(n,1),e._removeModelFromRanges(t)):(i[n].accept(r),"update"==r.__state__&&(i[n].dirty=!0)))})},_submit:function(e,r){var i=this;i.trigger(Y,{type:"submit"}),i.trigger(Z),i.transport.submit(N({success:function(r,i){var n=t.grep(e,function(t){return t.type==i})[0];n&&n.resolve({response:r,models:n.models,type:i})},error:function(t,r,n){for(var s=0;s<e.length;s++)e[s].reject(t);i.error(t,r,n)}},r))},_sendSubmit:function(e,r,i){var n=[];return this.options.batch&&(e.length&&n.push(t.Deferred(function(t){t.type="create",t.models=e})),r.length&&n.push(t.Deferred(function(t){t.type="update",t.models=r})),i.length&&n.push(t.Deferred(function(t){t.type="destroy",t.models=i})),this._submit(n,{data:{created:this.reader.serialize(p(e)),updated:this.reader.serialize(p(r)),destroyed:this.reader.serialize(p(i))}})),n},_promise:function(e,r,i){var n=this;return t.Deferred(function(t){n.trigger(Y,{type:i}),n.trigger(Z),n.transport[i].call(n.transport,N({success:function(e){t.resolve({response:e,models:r,type:i})},error:function(e,r,i){t.reject(e),n.error(e,r,i)}},e))}).promise()},_send:function(t,e){var r,i,n=[],s=this.reader.serialize(p(e));if(this.options.batch)e.length&&n.push(this._promise({data:{models:s}},e,t));else for(r=0,i=e.length;r<i;r++)n.push(this._promise({data:s[r]},[e[r]],t));return n},read:function(e){var r=this,i=r._params(e),n=t.Deferred();return r._queueRequest(i,function(){var t=r.trigger(Y,{type:"read"});t?(r._dequeueRequest(),n.resolve(t)):(r.trigger(Z),r._ranges=[],r.trigger("reset"),r.online()?r.transport.read({data:i,success:function(t){r._ranges=[],r.success(t,i),n.resolve()},error:function(){var t=dt.call(arguments);r.error.apply(r,t),n.reject.apply(n,t)}}):null!=r.options.offlineStorage&&(r.success(r.offlineData(),i),n.resolve()))}),n.promise()},_readAggregates:function(t){return this.reader.aggregates(t)},success:function(t){var r,i=this.options;if(this.trigger(tt,{response:t,type:"read"}),this.online()){if(t=this.reader.parse(t),this._handleCustomErrors(t))return void this._dequeueRequest();this._total=this.reader.total(t),this._aggregate&&i.serverAggregates&&(this._aggregateResult=this._readAggregates(t)),r=arguments.length>1?arguments[1]:e,t=this._readData(t,r),this._destroyed=[]}else{t=this._readData(t);var n,s=[],a={},o=this.reader.model,h=o?o.idField:"id";for(n=0;n<this._destroyed.length;n++){var u=this._destroyed[n][h];a[u]=u}for(n=0;n<t.length;n++){var l=t[n];"destroy"==l.__state__?a[l[h]]||this._destroyed.push(this._createNewModel(l)):s.push(l)}t=s,this._total=t.length}if(this._pristineTotal=this._total,this._pristineData=t.slice(0),this._detachObservableParents(),this.options.endless){this._data.unbind(X,this._changeHandler),t=this._observe(t);for(var d=0;d<t.length;d++)this._data.push(t[d]);this._data.bind(X,this._changeHandler)}else this._data=this._observe(t);this._markOfflineUpdatesAsDirty(),this._storeData(),this._addRange(this._data),this._process(this._data),this._dequeueRequest()},_detachObservableParents:function(){if(this._data&&this._shouldDetachObservableParents)for(var t=0;t<this._data.length;t++)this._data[t].parent&&(this._data[t].parent=J)},_storeData:function(t){function e(t){for(var n=[],s=0;s<t.length;s++){var a=t.at(s),o=a.toJSON();r&&a.items?o.items=e(a.items):(o.uid=a.uid,i&&(a.isNew()?o.__state__="create":a.dirty&&(o.__state__="update"))),n.push(o)}return n}var r=this._isServerGrouped(),i=this.reader.model;if(null!=this.options.offlineStorage){for(var n=e(this._data),s=[],a=0;a<this._destroyed.length;a++){var o=this._destroyed[a].toJSON();o.__state__="destroy",s.push(o)}this.offlineData(n.concat(s)),t&&(this._pristineData=this._readData(n))}},_addRange:function(t,e){var r=void 0!==e?e:this._skip||0,i=r+this._flatData(t,!0).length;this._ranges.push({start:r,end:i,data:t,timestamp:(new Date).getTime()}),this._ranges.sort(function(t,e){return t.start-e.start})},error:function(t,e,r){this._dequeueRequest(),this.trigger(tt,{}),this.trigger("error",{xhr:t,status:e,errorThrown:r})},_params:function(t){var e=N({take:this.take(),skip:this.skip(),page:this.page(),pageSize:this.pageSize(),sort:this._sort,filter:this._filter,group:this._group,aggregate:this._aggregate},t);return this.options.serverPaging||(delete e.take,delete e.skip,delete e.page,delete e.pageSize),this.options.serverGrouping?this.reader.model&&e.group&&(e.group=T(e.group,this.reader.model)):delete e.group,this.options.serverFiltering?this.reader.model&&e.filter&&(e.filter=C(e.filter,this.reader.model)):delete e.filter,this.options.serverSorting?this.reader.model&&e.sort&&(e.sort=T(e.sort,this.reader.model)):delete e.sort,this.options.serverAggregates?this.reader.model&&e.aggregate&&(e.aggregate=T(e.aggregate,this.reader.model)):delete e.aggregate,e},_queueRequest:function(t,r){this._requestInProgress?this._pending={callback:j(r,this),options:t}:(this._requestInProgress=!0,this._pending=e,r())},_dequeueRequest:function(){this._requestInProgress=!1,this._pending&&this._queueRequest(this._pending.options,this._pending.callback)},_handleCustomErrors:function(t){if(this.reader.errors){var e=this.reader.errors(t);if(e)return this.trigger("error",{xhr:null,status:"customerror",errorThrown:"custom error",errors:e}),!0}return!1},_shouldWrap:function(t){var e=this.reader.model;return!(!e||!t.length||t[0]instanceof e)},_observe:function(t){var e=this,r=e.reader.model;return e._shouldDetachObservableParents=!0,t instanceof _t?(e._shouldDetachObservableParents=!1,e._shouldWrap(t)&&(t.type=e.reader.model,t.wrapAll(t,t))):(t=new(e.pageSize()&&!e.options.serverPaging?vt:_t)(t,e.reader.model)).parent=function(){return e.parent()},e._isServerGrouped()&&w(t,r),e._changeHandler&&e._data&&e._data instanceof _t?e._data.unbind(X,e._changeHandler):e._changeHandler=j(e._change,e),t.bind(X,e._changeHandler)},_updateTotalForAction:function(t,e){var r=parseInt(this._total,10);c(this._total)||(r=parseInt(this._pristineTotal,10)),"add"===t?r+=e.length:"remove"===t?r-=e.length:"itemchange"===t||"sync"===t||this.options.serverPaging?"sync"===t&&(r=this._pristineTotal=parseInt(this._total,10)):r=this._pristineTotal,this._total=r},_change:function(t){var e,r,i=this,n=t?t.action:"";if("remove"===n)for(e=0,r=t.items.length;e<r;e++)t.items[e].isNew&&t.items[e].isNew()||i._destroyed.push(t.items[e]);if(!i.options.autoSync||"add"!==n&&"remove"!==n&&"itemchange"!==n)i._updateTotalForAction(n,t?t.items:[]),i._process(i._data,t);else{var s=function(e){"sync"===e.action&&(i.unbind("change",s),i._updateTotalForAction(n,t.items))};i.first("change",s),i.sync()}},_calculateAggregates:function(t,e){e=e||{};var r=new n(t),i=e.aggregate,s=e.filter;return s&&(r=r.filter(s)),r.aggregate(i)},_process:function(t,r){var i,n={};!0!==this.options.serverPaging&&(n.skip=this._skip,n.take=this._take||this._pageSize,n.skip===e&&this._page!==e&&this._pageSize!==e&&(n.skip=(this._page-1)*this._pageSize)),!0!==this.options.serverSorting&&(n.sort=this._sort),!0!==this.options.serverFiltering&&(n.filter=this._filter),!0!==this.options.serverGrouping&&(n.group=this._group),!0!==this.options.serverAggregates&&(n.aggregate=this._aggregate,this._aggregateResult=this._calculateAggregates(t,n)),i=this._queryProcess(t,n),this.view(i.data),i.total===e||this.options.serverFiltering||(this._total=i.total),(r=r||{}).items=r.items||this._view,this.trigger(X,r)},_queryProcess:function(t,e){return this.options.inPlaceSort?n.process(t,e,this.options.inPlaceSort):n.process(t,e)},_mergeState:function(t){return t!==e&&(this._pageSize=t.pageSize,this._page=t.page,this._sort=t.sort,this._filter=t.filter,this._group=t.group,this._aggregate=t.aggregate,this._skip=this._currentRangeStart=t.skip,this._take=t.take,this._skip===e&&(this._skip=this._currentRangeStart=this.skip(),t.skip=this.skip()),this._take===e&&this._pageSize!==e&&(this._take=this._pageSize,t.take=this._take),t.sort&&(this._sort=t.sort=s(t.sort)),t.filter&&(this._filter=t.filter=o(t.filter)),t.group&&(this._group=t.group=f(t.group)),t.aggregate&&(this._aggregate=t.aggregate=function(t){return E(t)?t:[t]}(t.aggregate))),t},query:function(r){var i;if(this.options.serverSorting||this.options.serverPaging||this.options.serverFiltering||this.options.serverGrouping||this.options.serverAggregates||(this._data===e||0===this._data.length)&&!this._destroyed.length){if(this.options.endless){var n=r.pageSize-this.pageSize();n>0?(n=this.pageSize(),r.page=r.pageSize/n,r.pageSize=n):(r.page=1,this.options.endless=!1)}return this.read(this._mergeState(r))}var s=this.trigger(Y,{type:"read"});return s||(this.trigger(Z),i=this._queryProcess(this._data,this._mergeState(r)),this.options.serverFiltering||(i.total!==e?this._total=i.total:this._total=this._data.length),this._aggregateResult=this._calculateAggregates(this._data,r),this.view(i.data),this.trigger(tt,{type:"read"}),this.trigger(X,{items:i.data})),t.Deferred().resolve(s).promise()},fetch:function(t){var e=this;return this._query().then(function(r){!0!==r&&W(t)&&t.call(e)})},_query:function(t){return this.query(N({},{page:this.page(),pageSize:this.pageSize(),sort:this.sort(),filter:this.filter(),group:this.group(),aggregate:this.aggregate()},t))},next:function(t){var e=this.page(),r=this.total();if(t=t||{},e&&!(r&&e+1>this.totalPages()))return this._skip=this._currentRangeStart=e*this.take(),e+=1,t.page=e,this._query(t),e},prev:function(t){var e=this.page();if(t=t||{},e&&1!==e)return this._skip=this._currentRangeStart=this._skip-this.take(),e-=1,t.page=e,this._query(t),e},page:function(t){var r;return t!==e?(t=st.max(st.min(st.max(t,1),this.totalPages()),1),void this._query({page:t})):(r=this.skip())!==e?st.round((r||0)/(this.take()||1))+1:e},pageSize:function(t){if(t===e)return this.take();this._query({pageSize:t,page:1})},sort:function(t){if(t===e)return this._sort;this._query({sort:t})},filter:function(t){if(t===e)return this._filter;this.trigger("reset"),this._query({filter:t,page:1})},group:function(t){if(t===e)return this._group;this._query({group:t})},total:function(){return parseInt(this._total||0,10)},aggregate:function(t){if(t===e)return this._aggregate;this._query({aggregate:t})},aggregates:function(){var t=this._aggregateResult;return B(t)&&(t=this._emptyAggregates(this.aggregate())),t},_emptyAggregates:function(t){var e={};if(!B(t)){var r={};E(t)||(t=[t]);for(var i=0;i<t.length;i++)r[t[i].aggregate]=0,e[t[i].field]=r}return e},_wrapInEmptyGroup:function(t){var e,r,i,n=this.group();for(i=n.length-1;i>=0;i--)r=n[i],e={value:t.get(r.field),field:r.field,items:e?[e]:[t],hasSubgroups:!!e,aggregates:this._emptyAggregates(r.aggregates)};return e},totalPages:function(){var t=this.pageSize()||this.total();return st.ceil((this.total()||0)/t)},inRange:function(t,e){var r=st.min(t+e,this.total());return!this.options.serverPaging&&this._data.length>0||this._findRange(t,r).length>0},lastRange:function(){var t=this._ranges;return t[t.length-1]||{start:0,end:0,data:[]}},firstItemUid:function(){var t=this._ranges;return t.length&&t[0].data.length&&t[0].data[0].uid},enableRequestsInProgress:function(){this._skipRequestsInProgress=!1},_timeStamp:function(){return(new Date).getTime()},range:function(t,r,i){this._currentRequestTimeStamp=this._timeStamp(),this._skipRequestsInProgress=!0,t=st.min(t||0,this.total());var n,s=this,a=st.max(st.floor(t/r),0)*r,o=st.min(a+r,s.total());if((n=s._findRange(t,st.min(t+r,s.total()))).length){s._pending=e,s._skip=t>s.skip()?st.min(o,(s.totalPages()-1)*s.take()):a,s._currentRangeStart=t,s._take=r;var h=s.options.serverPaging,u=s.options.serverSorting,l=s.options.serverFiltering,d=s.options.serverAggregates;try{s.options.serverPaging=!0,s._isServerGrouped()||s.group()&&s.group().length||(s.options.serverSorting=!0),s.options.serverFiltering=!0,s.options.serverPaging=!0,s.options.serverAggregates=!0,h&&(s._detachObservableParents(),s._data=n=s._observe(n)),s._process(n)}finally{s.options.serverPaging=h,s.options.serverSorting=u,s.options.serverFiltering=l,s.options.serverAggregates=d}W(i)&&i()}else r!==e&&(s._rangeExists(a,o)?a<t&&s.prefetch(o,r,function(){s.range(t,r,i)}):s.prefetch(a,r,function(){t>a&&o<s.total()&&!s._rangeExists(o,st.min(o+r,s.total()))?s.prefetch(o,r,function(){s.range(t,r,i)}):s.range(t,r,i)}))},_findRange:function(t,r){var i,n,a,o,h,u,l,d,c,g,p,_=this._ranges,v=[],m=this.options,y=m.serverSorting||m.serverPaging||m.serverFiltering||m.serverGrouping||m.serverAggregates;for(n=0,p=_.length;n<p;n++)if(i=_[n],t>=i.start&&t<=i.end){for(g=0,a=n;a<p;a++)if(i=_[a],(c=this._flatData(i.data,!0)).length&&t+g>=i.start){if(u=i.data,l=i.end,!y){if(m.inPlaceSort)d=this._queryProcess(i.data,{filter:this.filter()});else{var S=f(this.group()||[]).concat(s(this.sort()||[]));d=this._queryProcess(i.data,{sort:S,filter:this.filter()})}c=u=d.data,d.total!==e&&(l=d.total)}if(o=0,t+g>i.start&&(o=t+g-i.start),h=c.length,l>r&&(h-=l-r),g+=h-o,v=this._mergeGroups(v,u,o,h),r<=i.end&&g==r-t)return v}break}return[]},_mergeGroups:function(t,e,r,i){if(this._isServerGrouped()){var n,s=e.toJSON();return t.length&&(n=t[t.length-1]),S(n,s,r,i),t.concat(s)}return t.concat(e.slice(r,i))},skip:function(){return this._skip===e?this._page!==e?(this._page-1)*(this.take()||1):e:this._skip},currentRangeStart:function(){return this._currentRangeStart||0},take:function(){return this._take||this._pageSize},_prefetchSuccessHandler:function(t,e,r,i){var n=this,s=n._timeStamp();return function(a){var o,h,u,l=!1,d={start:t,end:e,data:[],timestamp:n._timeStamp()};if(n._dequeueRequest(),n.trigger(tt,{response:a,type:"read"}),a=n.reader.parse(a),(u=n._readData(a)).length){for(o=0,h=n._ranges.length;o<h;o++)if(n._ranges[o].start===t){l=!0,d=n._ranges[o];break}l||n._ranges.push(d)}d.data=n._observe(u),d.end=d.start+n._flatData(d.data,!0).length,n._ranges.sort(function(t,e){return t.start-e.start}),n._total=n.reader.total(a),(i||s>=n._currentRequestTimeStamp||!n._skipRequestsInProgress)&&(r&&u.length?r():n.trigger(X,{}))}},prefetch:function(t,e,r){var i=this,n=st.min(t+e,i.total()),s={take:e,skip:t,page:t/e+1,pageSize:e,sort:i._sort,filter:i._filter,group:i._group,aggregate:i._aggregate};i._rangeExists(t,n)?r&&r():(clearTimeout(i._timeout),i._timeout=setTimeout(function(){i._queueRequest(s,function(){i.trigger(Y,{type:"read"})?i._dequeueRequest():i.transport.read({data:i._params(s),success:i._prefetchSuccessHandler(t,n,r),error:function(){var t=dt.call(arguments);i.error.apply(i,t)}})})},100))},_multiplePrefetch:function(t,e,r){var i=st.min(t+e,this.total()),n={take:e,skip:t,page:t/e+1,pageSize:e,sort:this._sort,filter:this._filter,group:this._group,aggregate:this._aggregate};this._rangeExists(t,i)?r&&r():this.trigger(Y,{type:"read"})||this.transport.read({data:this._params(n),success:this._prefetchSuccessHandler(t,i,r,!0)})},_rangeExists:function(t,e){var r,i,n=this._ranges;for(r=0,i=n.length;r<i;r++)if(n[r].start<=t&&n[r].end>=e)return!0;return!1},_removeModelFromRanges:function(t){for(var e,r,i=this,n=0,s=this._ranges.length;n<s&&(r=this._ranges[n],this._eachItem(r.data,function(r){(i.options.useRanges&&!i.options.serverPaging?R(r,t,i.currentRangeStart(),i.take()):R(r,t))&&(e=!0)}),!e);n++);i._updateRangesLength()},_insertModelInRange:function(t,e){var r,i,n=this._ranges||[],s=n.length;for(i=0;i<s;i++)if((r=n[i]).start<=t&&r.end>=t){this._getByUid(e.uid,r.data)||(this._isServerGrouped()?r.data.splice(t,0,this._wrapInEmptyGroup(e)):r.data.splice(t,0,e));break}this._updateRangesLength()},_updateRangesLength:function(){var t,e,r=this._ranges||[],i=r.length,n=!1,s=0,a=0;for(e=0;e<i;e++)t=r[e],a=this._flatData(t.data,!0).length-st.abs(t.end-t.start),n||0===a?n&&(t.start+=s,t.end+=s):(n=!0,s=a,t.end+=s)}}),Ct={};Ct.create=function(e,r,i){var n,s=e.transport?t.extend({},e.transport):null;return s?(s.read=typeof s.read===K?{url:s.read}:s.read,"jsdo"===e.type&&(s.dataSource=i),e.type&&(V.data.transports=V.data.transports||{},V.data.schemas=V.data.schemas||{},V.data.transports[e.type]?G(V.data.transports[e.type])?s=N(!0,{},V.data.transports[e.type],s):n=new V.data.transports[e.type](N(s,{data:r})):V.logToConsole("Unknown DataSource transport type '"+e.type+"'.\nVerify that registration scripts for this type are included after Kendo UI on the page.","warn"),e.schema=N(!0,{},V.data.schemas[e.type],e.schema)),n||(n=W(s.read)?s:new Dt(s))):n=new Rt({data:e.data||[]}),n},Pt.create=function(r){(E(r)||r instanceof _t)&&(r={data:r});var i,n,s,a=r||{},o=a.data,h=a.fields,u=a.table,l=a.select,d={};if(o||!h||a.transport||(u?o=function(e,r){var i,n,s,a,o,h,u,l=t(e)[0].tBodies[0],d=l?l.rows:[],f=r.length,c=[];for(i=0,n=d.length;i<n;i++){for(o={},u=!0,a=d[i].cells,s=0;s<f;s++)"th"!==(h=a[s]).nodeName.toLowerCase()&&(u=!1,o[r[s].field]=h.innerHTML);u||c.push(o)}return c}(u,h):l&&(o=function(e,r){var i,n,s,a,o,h,u=(e=t(e)[0]).options,l=r[0],d=r[1],f=[];for(i=0,n=u.length;i<n;i++)o={},(s=(a=u[i]).parentNode)===e&&(s=null),a.disabled||s&&s.disabled||(s&&(o.optgroup=s.label),o[l.field]=a.text,h=(h=a.attributes.value)&&h.specified?a.value:a.text,o[d.field]=h,f.push(o));return f}(l,h),a.group===e&&o[0]&&o[0].optgroup!==e&&(a.group="optgroup"))),V.data.Model&&h&&(!a.schema||!a.schema.model)){for(i=0,n=h.length;i<n;i++)(s=h[i]).type&&(d[s.field]=s);B(d)||(a.schema=N(!0,a.schema,{model:{fields:d}}))}return a.data=o,l=null,a.select=null,u=null,a.table=null,a instanceof Pt?a:new Pt(a)};var Tt=bt.define({idField:"id",init:function(t){var e=this.hasChildren||t&&t.hasChildren,r="items",i={};if(V.data.Model.fn.init.call(this,t),typeof this.children===K&&(r=this.children),i={schema:{data:r,model:{hasChildren:e,id:this.idField,fields:this.fields}}},typeof this.children!==K&&N(i,this.children),i.data=t,e||(e=i.schema.data),typeof e===K&&(e=V.getter(e)),W(e)){var n=e.call(this,this);n&&0===n.length?this.hasChildren=!1:this.hasChildren=!!n}this._childrenOptions=i,this.hasChildren&&this._initChildren(),this._loaded=!(!t||!t._loaded)},_initChildren:function(){var t,e,r,i=this;i.children instanceof At||(e=(t=i.children=new At(i._childrenOptions)).transport,r=e.parameterMap,e.parameterMap=function(t,e){return t[i.idField||"id"]=i.id,r&&(t=r(t,e)),t},t.parent=function(){return i},t.bind(X,function(t){t.node=t.node||i,i.trigger(X,t)}),t.bind("error",function(t){var e=i.parent();e&&(t.node=t.node||i,e.trigger("error",t))}),i._updateChildrenField())},append:function(t){this._initChildren(),this.loaded(!0),this.children.add(t)},hasChildren:!1,level:function(){for(var t=this.parentNode(),e=0;t&&t.parentNode;)e++,t=t.parentNode?t.parentNode():null;return e},_updateChildrenField:function(){this[this._childrenOptions.schema.data||"items"]=this.children.data()},_childrenLoaded:function(){this._loaded=!0,this._updateChildrenField()},load:function(){var r,i,n={},s="_query";return this.hasChildren?(this._initChildren(),r=this.children,n[this.idField||"id"]=this.id,this._loaded||(r._data=e,s="read"),r.one(X,j(this._childrenLoaded,this)),this._matchFilter&&(n.filter={field:"_matchFilter",operator:"eq",value:!0}),i=r[s](n)):this.loaded(!0),i||t.Deferred().resolve().promise()},parentNode:function(){return this.parent().parent()},loaded:function(t){if(t===e)return this._loaded;this._loaded=t},shouldSerialize:function(t){return bt.fn.shouldSerialize.call(this,t)&&"children"!==t&&"_loaded"!==t&&"hasChildren"!==t&&"_childrenOptions"!==t}}),At=Pt.extend({init:function(t){var e=Tt.define({children:t});t.filter&&!t.serverFiltering&&(this._hierarchicalFilter=t.filter,t.filter=null),Pt.fn.init.call(this,N(!0,{},{schema:{modelBase:e,model:e}},t)),this._attachBubbleHandlers()},_attachBubbleHandlers:function(){var t=this;t._data.bind("error",function(e){t.trigger("error",e)})},read:function(t){var e=Pt.fn.read.call(this,t);return this._hierarchicalFilter&&(this._data&&this._data.length>0?this.filter(this._hierarchicalFilter):(this.options.filter=this._hierarchicalFilter,this._filter=o(this.options.filter),this._hierarchicalFilter=null)),e},remove:function(t){var e,r=t.parentNode(),i=this;return r&&r._initChildren&&(i=r.children),e=Pt.fn.remove.call(i,t),r&&!i.data().length&&(r.hasChildren=!1),e},success:A("success"),data:A("data"),insert:function(t,e){var r=this.parent();return r&&r._initChildren&&(r.hasChildren=!0,r._initChildren()),Pt.fn.insert.call(this,t,e)},filter:function(t){if(t===e)return this._filter;!this.options.serverFiltering&&this._markHierarchicalQuery(t)&&(t={logic:"or",filters:[t,{field:"_matchFilter",operator:"equals",value:!0}]}),this.trigger("reset"),this._query({filter:t,page:1})},_markHierarchicalQuery:function(t){var e,r,i,s,a;return(t=o(t))&&0!==t.filters.length?(e=n.filterExpr(t),i=e.fields,s=e.operators,r=a=new Function("d, __f, __o","return "+e.expression),(i.length||s.length)&&(a=function(t){return r(t,i,s)}),this._updateHierarchicalFilter(a),!0):(this._updateHierarchicalFilter(function(){return!0}),!1)},_updateHierarchicalFilter:function(t){for(var e,r=this._data,i=!1,n=0;n<r.length;n++)(e=r[n]).hasChildren?(e._matchFilter=e.children._updateHierarchicalFilter(t),e._matchFilter||(e._matchFilter=t(e))):e._matchFilter=t(e),e._matchFilter&&(i=!0);return i},_find:function(t,e){var r,i,n,s,a=this._data;if(a){if(n=Pt.fn[t].call(this,e))return n;for(r=0,i=(a=this._flatData(this._data)).length;r<i;r++)if((s=a[r].children)instanceof At&&(n=s[t](e)))return n}},get:function(t){return this._find("get",t)},getByUid:function(t){return this._find("getByUid",t)}});At.create=function(t){var e=(t=t&&t.push?{data:t}:t)||{},r=e.data,i=e.fields,n=e.list;return r&&r._dataSource?r._dataSource:(r||!i||e.transport||n&&(r=I(n,i)),e.data=r,e instanceof At?e:new At(e))};var It=V.Observable.extend({init:function(t,e,r){V.Observable.fn.init.call(this),this._prefetching=!1,this.dataSource=t,this.prefetch=!r;var i=this;t.bind("change",function(){i._change()}),t.bind("reset",function(){i._reset()}),this._syncWithDataSource(),this.setViewSize(e)},setViewSize:function(t){this.viewSize=t,this._recalculate()},at:function(t){var e=this.pageSize,r=!0;return t>=this.total()?(this.trigger("endreached",{index:t}),null):this.useRanges?this.useRanges?((t<this.dataOffset||t>=this.skip+e)&&(r=this.range(Math.floor(t/e)*e)),t===this.prefetchThreshold&&this._prefetch(),t===this.midPageThreshold?this.range(this.nextMidRange,!0):t===this.nextPageThreshold?this.range(this.nextFullRange):t===this.pullBackThreshold&&(this.offset===this.skip?this.range(this.previousMidRange):this.range(this.previousFullRange)),r?this.dataSource.at(t-this.dataOffset):(this.trigger("endreached",{index:t}),null)):void 0:this.dataSource.view()[t]},indexOf:function(t){return this.dataSource.data().indexOf(t)+this.dataOffset},total:function(){return parseInt(this.dataSource.total(),10)},next:function(){var t=this,e=t.pageSize,r=t.skip-t.viewSize+e,i=st.max(st.floor(r/e),0)*e;this.offset=r,this.dataSource.prefetch(i,e,function(){t._goToRange(r,!0)})},range:function(t,e){if(this.offset===t)return!0;var r=this,i=this.pageSize,n=st.max(st.floor(t/i),0)*i,s=this.dataSource;return e&&(n+=i),s.inRange(t,i)?(this.offset=t,this._recalculate(),this._goToRange(t),!0):!this.prefetch||(s.prefetch(n,i,function(){r.offset=t,r._recalculate(),r._goToRange(t,!0)}),!1)},syncDataSource:function(){var t=this.offset;this.offset=null,this.range(t)},destroy:function(){this.unbind()},_prefetch:function(){var t=this,e=this.pageSize,r=this.skip+e,i=this.dataSource;i.inRange(r,e)||this._prefetching||!this.prefetch||(this._prefetching=!0,this.trigger("prefetching",{skip:r,take:e}),i.prefetch(r,e,function(){t._prefetching=!1,t.trigger("prefetched",{skip:r,take:e})}))},_goToRange:function(t,e){this.offset===t&&(this.dataOffset=t,this._expanding=e,this.dataSource.range(t,this.pageSize),this.dataSource.enableRequestsInProgress())},_reset:function(){this._syncPending=!0},_change:function(){var t=this.dataSource;this.length=this.useRanges?t.lastRange().end:t.view().length,this._syncPending&&(this._syncWithDataSource(),this._recalculate(),this._syncPending=!1,this.trigger("reset",{offset:this.offset})),this.trigger("resize"),this._expanding&&this.trigger("expand"),delete this._expanding},_syncWithDataSource:function(){var t=this.dataSource;this._firstItemUid=t.firstItemUid(),this.dataOffset=this.offset=t.skip()||0,this.pageSize=t.pageSize(),this.useRanges=t.options.serverPaging},_recalculate:function(){var t=this.pageSize,e=this.offset,r=this.viewSize,i=Math.ceil(e/t)*t;this.skip=i,this.midPageThreshold=i+t-1,this.nextPageThreshold=i+r-1,this.prefetchThreshold=i+Math.floor(t/3*2),this.pullBackThreshold=this.offset-1,this.nextMidRange=i+t-r,this.nextFullRange=i,this.previousMidRange=e-r,this.previousFullRange=i-t}}),Mt=V.Observable.extend({init:function(t,e){var r=this;V.Observable.fn.init.call(r),this.dataSource=t,this.batchSize=e,this._total=0,this.buffer=new It(t,3*e),this.buffer.bind({endreached:function(t){r.trigger("endreached",{index:t.index})},prefetching:function(t){r.trigger("prefetching",{skip:t.skip,take:t.take})},prefetched:function(t){r.trigger("prefetched",{skip:t.skip,take:t.take})},reset:function(){r._total=0,r.trigger("reset")},resize:function(){r._total=Math.ceil(this.length/r.batchSize),r.trigger("resize",{total:r.total(),offset:this.offset})}})},syncDataSource:function(){this.buffer.syncDataSource()},at:function(t){var e,r=this.buffer,i=t*this.batchSize,n=this.batchSize,s=[];r.offset>i&&r.at(r.offset-1);for(var a=0;a<n&&null!==(e=r.at(i+a));a++)s.push(e);return s},total:function(){return this._total},destroy:function(){this.buffer.destroy(),this.unbind()}});N(!0,V.data,{readers:{json:zt},Query:n,DataSource:Pt,HierarchicalDataSource:At,Node:Tt,ObservableObject:mt,ObservableArray:_t,LazyObservableArray:vt,LocalTransport:Rt,RemoteTransport:Dt,Cache:Ot,DataReader:zt,Model:bt,Buffer:It,BatchBuffer:Mt})}(window.kendo.jQuery),window.kendo});