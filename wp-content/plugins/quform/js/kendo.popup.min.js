(typeof define=="function"&&define.amd?define:function(e,t,i){(i||t)()})("kendo.popup",["kendo.core"],function(){return function(e,t){function i(t,i){return!(!t||!i)&&(t===i||e.contains(t,i))}var o=window.kendo,n=o.ui,s=n.Widget,r=o.Class,a=o.support,l=o.getOffset,d=o._outerWidth,p=o._outerHeight,c="position",h="k-state-border",f=/k-state-border-(\w+)/,u=".k-picker-wrap, .k-dropdown-wrap, .k-link",m=e(document.documentElement),g=e.proxy,v=e(window),w=a.transitions.css+"transform",_=e.extend,b=".kendoPopup",y=["font-size","font-family","font-stretch","font-style","font-weight","line-height"],k=s.extend({init:function(t,i){var n,r=this;(i=i||{}).isRtl&&(i.origin=i.origin||"bottom right",i.position=i.position||"top right"),s.fn.init.call(r,t,i),t=r.element,i=r.options,r.collisions=i.collision?i.collision.split(" "):[],r.downEvent=o.applyEventMap("down",o.guid()),1===r.collisions.length&&r.collisions.push(r.collisions[0]),n=e(r.options.anchor).closest(".k-popup,.k-group").filter(":not([class^=km-])"),i.appendTo=e(e(i.appendTo)[0]||n[0]||document.body),r.element.hide().addClass("k-popup k-group k-reset").toggleClass("k-rtl",!!i.isRtl).css({position:"absolute"}).appendTo(i.appendTo).attr("aria-hidden",!0).on("mouseenter"+b,function(){r._hovered=!0}).on("wheel"+b,function(t){var i=e(this).find(".k-list").parent();(0===i.scrollTop()&&t.originalEvent.deltaY<0||i.scrollTop()===i.prop("scrollHeight")-i.prop("offsetHeight")&&t.originalEvent.deltaY>0)&&t.preventDefault()}).on("mouseleave"+b,function(){r._hovered=!1}),r.wrapper=e(),!1===i.animation&&(i.animation={open:{effects:{}},close:{hide:!0,effects:{}}}),_(i.animation.open,{complete:function(){r.wrapper.css({overflow:"visible"}),r._activated=!0,r._trigger("activate")}}),_(i.animation.close,{complete:function(){r._animationClose()}}),r._mousedownProxy=function(e){r._mousedown(e)},a.mobileOS.android?r._resizeProxy=function(e){setTimeout(function(){r._resize(e)},600)}:r._resizeProxy=function(e){r._resize(e)},i.toggleTarget&&e(i.toggleTarget).on(i.toggleEvent+b,e.proxy(r.toggle,r))},events:["open","activate","close","deactivate"],options:{name:"Popup",toggleEvent:"click",origin:"bottom left",position:"top left",anchor:"body",appendTo:null,collision:"flip fit",viewport:window,copyAnchorStyles:!0,autosize:!1,modal:!1,adjustSize:{width:0,height:0},animation:{open:{effects:"slideIn:down",transition:!0,duration:200},close:{duration:100,hide:!0}}},_animationClose:function(){var e=this.wrapper.data("location");this.wrapper.hide(),e&&this.wrapper.css(e),"body"!=this.options.anchor&&this._hideDirClass(),this._closing=!1,this._trigger("deactivate")},destroy:function(){var t,i=this.options,n=this.element.off(b);s.fn.destroy.call(this),i.toggleTarget&&e(i.toggleTarget).off(b),i.modal||(m.unbind(this.downEvent,this._mousedownProxy),this._toggleResize(!1)),o.destroy(this.element.children()),n.removeData(),i.appendTo[0]===document.body&&((t=n.parent(".k-animation-container"))[0]?t.remove():n.remove())},open:function(t,i){var n,s,r={isFixed:!isNaN(parseInt(i,10)),x:t,y:i},l=this.element,d=this.options,p=e(d.anchor),h=l[0]&&l.hasClass("km-widget");if(!this.visible()){if(d.copyAnchorStyles&&(h&&"font-size"==y[0]&&y.shift(),l.css(o.getComputedStyles(p[0],y))),l.data("animating")||this._trigger("open"))return;this._activated=!1,d.modal||(m.unbind(this.downEvent,this._mousedownProxy).bind(this.downEvent,this._mousedownProxy),this._toggleResize(!1),this._toggleResize(!0)),this.wrapper=s=o.wrap(l,d.autosize).css({overflow:"hidden",display:"block",position:"absolute"}).attr("aria-hidden",!1),a.mobileOS.android&&s.css(w,"translatez(0)"),s.css(c),e(d.appendTo)[0]==document.body&&s.css("top","-10000px"),this.flipped=this._position(r),n=this._openAnimation(),"body"!=d.anchor&&this._showDirClass(n),l.data("effects",n.effects).kendoStop(!0).kendoAnimate(n).attr("aria-hidden",!1)}},_location:function(t){var i,n=this.element,s=this.options,r=e(s.anchor),l=n[0]&&n.hasClass("km-widget");s.copyAnchorStyles&&(l&&"font-size"==y[0]&&y.shift(),n.css(o.getComputedStyles(r[0],y))),this.wrapper=i=o.wrap(n,s.autosize).css({overflow:"hidden",display:"block",position:"absolute"}),a.mobileOS.android&&i.css(w,"translatez(0)"),i.css(c),e(s.appendTo)[0]==document.body&&i.css("top","-10000px"),this._position(t||{});var d=i.offset();return{width:o._outerWidth(i),height:o._outerHeight(i),left:d.left,top:d.top}},_openAnimation:function(){var e=_(!0,{},this.options.animation.open);return e.effects=o.parseEffects(e.effects,this.flipped),e},_hideDirClass:function(){var t=e(this.options.anchor),i=((t.attr("class")||"").match(f)||["","down"])[1],n=h+"-"+i;t.removeClass(n).children(u).removeClass("k-state-active").removeClass(n),this.element.removeClass(h+"-"+o.directions[i].reverse)},_showDirClass:function(t){var i=t.effects.slideIn?t.effects.slideIn.direction:"down",n=h+"-"+i;e(this.options.anchor).addClass(n).children(u).addClass("k-state-active").addClass(n),this.element.addClass(h+"-"+o.directions[i].reverse)},position:function(){this.visible()&&(this.flipped=this._position())},toggle:function(){this[this.visible()?"close":"open"]()},visible:function(){return this.element.is(":visible")},close:function(t){var i,n,s,r,a=this.options;if(this.visible()){if(i=this.wrapper[0]?this.wrapper:o.wrap(this.element).hide(),this._toggleResize(!1),this._closing||this._trigger("close"))return void this._toggleResize(!0);this.element.find(".k-popup").each(function(){var i=e(this).data("kendoPopup");i&&i.close(t)}),m.unbind(this.downEvent,this._mousedownProxy),t?n={hide:!0,effects:{}}:(n=_(!0,{},a.animation.close),s=this.element.data("effects"),!(r=n.effects)&&!o.size(r)&&s&&o.size(s)&&(n.effects=s,n.reverse=!0),this._closing=!0),this.element.kendoStop(!0).attr("aria-hidden",!0),i.css({overflow:"hidden"}).attr("aria-hidden",!0),this.element.kendoAnimate(n),t&&this._animationClose()}},_trigger:function(e){return this.trigger(e,{type:e})},_resize:function(e){var t=this;-1!==a.resize.indexOf(e.type)?(clearTimeout(t._resizeTimeout),t._resizeTimeout=setTimeout(function(){t._position(),t._resizeTimeout=null},50)):(!t._hovered||t._activated&&t.element.hasClass("k-list-container"))&&t.close()},_toggleResize:function(e){var t=e?"on":"off",i=a.resize;a.mobileOS.ios||a.mobileOS.android||(i+=" scroll"),this._scrollableParents()[t]("scroll",this._resizeProxy),v[t](i,this._resizeProxy)},_mousedown:function(t){var n=this.element[0],s=this.options,r=e(s.anchor)[0],a=s.toggleTarget,l=o.eventTarget(t),d=e(l).closest(".k-popup"),p=d.parent().parent(".km-shim").length;d=d[0],!p&&d&&d!==this.element[0]||"popover"!==e(t.target).closest("a").data("rel")&&(i(n,l)||i(r,l)||a&&i(e(a)[0],l)||this.close())},_fit:function(e,t,i){var o=0;return e+t>i&&(o=i-(e+t)),e<0&&(o=-e),o},_flip:function(e,t,i,o,n,s,r){var a=0;return r=r||t,s!==n&&"center"!==s&&"center"!==n&&(e+r>o&&(a+=-(i+t)),e+a<0&&(a+=i+t)),a},_scrollableParents:function(){return e(this.options.anchor).parentsUntil("body").filter(function(e,t){return o.isScrollable(t)})},_position:function(t){var i,n,s,r,h,f,u,m=this.element,g=this.wrapper,v=this.options,w=e(v.viewport),b=a.zoomLevel(),y=!!(w[0]==window&&window.innerWidth&&b<=1.02),k=e(v.anchor),x=v.origin.toLowerCase().split(" "),z=v.position.toLowerCase().split(" "),T=this.collisions,C=10002,S=0,E=document.documentElement;if(h=v.viewport===window?{top:window.pageYOffset||document.documentElement.scrollTop||0,left:window.pageXOffset||document.documentElement.scrollLeft||0}:w.offset(),y?(f=window.innerWidth,u=window.innerHeight):(f=w.width(),u=w.height()),y&&E.scrollHeight-E.clientHeight>0&&(f-=(v.isRtl?-1:1)*o.support.scrollbar()),(i=k.parents().filter(g.siblings()))[0])if(s=Math.max(Number(i.css("zIndex")),0))C=s+10;else for(r=(n=k.parentsUntil(i)).length;S<r;S++)(s=Number(e(n[S]).css("zIndex")))&&C<s&&(C=s+10);g.css("zIndex",C),t&&t.isFixed?g.css({left:t.x,top:t.y}):g.css(this._align(x,z));var I=l(g,c,k[0]===g.offsetParent()[0]),P=l(g);k.offsetParent().parent(".k-animation-container,.k-popup,.k-group").length&&(I=l(g,c,!0),P=l(g)),P.top-=h.top,P.left-=h.left,this.wrapper.data("location")||g.data("location",_({},I));var R=_({},P),A=_({},I),D=v.adjustSize;"fit"===T[0]&&(A.top+=this._fit(R.top,p(g)+D.height,u/b)),"fit"===T[1]&&(A.left+=this._fit(R.left,d(g)+D.width,f/b));var O=_({},A),H=p(m),N=p(g);return!g.height()&&H&&(N+=H),"flip"===T[0]&&(A.top+=this._flip(R.top,H,p(k),u/b,x[0],z[0],N)),"flip"===T[1]&&(A.left+=this._flip(R.left,d(m),d(k),f/b,x[1],z[1],d(g))),m.css(c,"absolute"),g.css(A),A.left!=O.left||A.top!=O.top},_align:function(t,i){var o,n=this.wrapper,s=e(this.options.anchor),r=t[0],a=t[1],c=i[0],h=i[1],f=l(s),u=e(this.options.appendTo),m=d(n),g=p(n)||p(n.children().first()),v=d(s),w=p(s),_=f.top,b=f.left,y=Math.round;return u[0]!=document.body&&(_-=(o=l(u)).top,b-=o.left),"bottom"===r&&(_+=w),"center"===r&&(_+=y(w/2)),"bottom"===c&&(_-=g),"center"===c&&(_-=y(g/2)),"right"===a&&(b+=v),"center"===a&&(b+=y(v/2)),"right"===h&&(b-=m),"center"===h&&(b-=y(m/2)),{top:_,left:b}}});n.plugin(k);var x=o.support.stableSort,z="kendoTabKeyTrap",T=r.extend({init:function(t){this.element=e(t),this.element.autoApplyNS(z)},trap:function(){this.element.on("keydown",g(this._keepInTrap,this))},removeTrap:function(){this.element.kendoDestroy(z)},destroy:function(){this.element.kendoDestroy(z),this.element=void 0},shouldTrap:function(){return!0},_keepInTrap:function(e){if(9===e.which&&this.shouldTrap()&&!e.isDefaultPrevented()){var t=this._focusableElements(),i=this._sortFocusableElements(t),o=this._nextFocusable(e,i);this._focus(o),e.preventDefault()}},_focusableElements:function(){var t=this.element.find("a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, [tabindex], *[contenteditable]").filter(function(t,i){return i.tabIndex>=0&&e(i).is(":visible")&&!e(i).is(":disabled")});return this.element.is("[tabindex]")&&t.push(this.element[0]),t},_sortFocusableElements:function(e){var t;if(x)t=e.sort(function(e,t){return e.tabIndex-t.tabIndex});else{var i="__k_index";e.each(function(e,t){t.setAttribute(i,e)}),t=e.sort(function(e,t){return e.tabIndex===t.tabIndex?parseInt(e.getAttribute(i),10)-parseInt(t.getAttribute(i),10):e.tabIndex-t.tabIndex}),e.removeAttr(i)}return t},_nextFocusable:function(e,t){var i=t.length,o=t.index(e.target);return t.get((o+(e.shiftKey?-1:1))%i)},_focus:function(e){e.focus(),"INPUT"==e.nodeName&&e.setSelectionRange&&this._haveSelectionRange(e)&&e.setSelectionRange(0,e.value.length)},_haveSelectionRange:function(e){var t=e.type.toLowerCase();return"text"===t||"search"===t||"url"===t||"tel"===t||"password"===t}});n.Popup.TabKeyTrap=T}(window.kendo.jQuery),window.kendo});